!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("CustomGPTWidget",[],t):"object"==typeof exports?exports.CustomGPTWidget=t():e.CustomGPTWidget=t()}("undefined"!=typeof self?self:this,()=>(()=>{var e,t,s,a={396:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=396,e.exports=t},1582:(e,t,s)=>{"use strict";s.d(t,{o:()=>h});var a=s(1446),n=s(4267),r=s(7292),i=s(7648),o=s(7047),c=s(3345),l=s(5772),d=s(1681);const g="customgpt-messages-cache";function u(e,t){try{const s=localStorage.getItem(g),a=s?JSON.parse(s):{};a[e]=t,localStorage.setItem(g,JSON.stringify(a))}catch(e){}}async function m(e,t){const s=(0,n.KU)(),a=[];for(let n=0;n<e.length;n++){const r=e[n];try{const e=await s.getCitation(t,r);e.data&&a.push({id:r.toString(),index:n+1,title:e.data.title||`Citation ${n+1}`,source:e.data.url,url:e.data.url,content:e.data.description||""})}catch(e){l.v.warn("MESSAGES","Failed to fetch citation details",{citationId:r,error:e instanceof Error?e.message:String(e)}),a.push({id:r.toString(),index:n+1,title:`Citation ${n+1}`,source:"",url:"",content:"Citation details unavailable"})}}return a}const h=(0,a.vt)((e,t)=>({messages:new Map,streamingMessage:null,isStreaming:!1,loading:!1,error:null,sendMessage:async(s,a)=>{"undefined"!=typeof window&&window.__customgpt_demo_mode;const c=r.o.getState(),d=i.w.getState(),{currentAgent:g}=c;if(!g)throw l.v.error("MESSAGES","No agent selected when trying to send message"),new Error("No agent selected");l.v.info("MESSAGES","Sending message",{agentId:g.id,agentName:g.project_name,messageLength:s.length,hasFiles:a&&a.length>0});const u=await d.ensureConversation(g.id,s);if(l.v.info("MESSAGES","Conversation ensured",{conversationId:u.id,sessionId:u.session_id,hasSessionId:!!u.session_id,isNew:!u.message_count||0===u.message_count}),!u.session_id)throw l.v.error("MESSAGES","Conversation missing session_id",{conversation:u}),new Error("Conversation missing session_id");e({loading:!0,error:null});const h={id:(0,o.$C)(),role:"user",content:s,timestamp:(new Date).toISOString(),status:"sending"};t().addMessage(u.id.toString(),h);const p={id:(0,o.$C)(),role:"assistant",content:"",timestamp:(new Date).toISOString(),citations:[]};e({streamingMessage:p,isStreaming:!0,loading:!1});try{let r=[];if(a&&a.length>0){const e=(0,n.KU)();r=(await Promise.all(a.map(t=>e.uploadFile(g.id,t)))).filter(e=>e?.data?.id).map(e=>e.data.id.toString()),l.v.info("MESSAGES","Files uploaded successfully",{fileCount:a.length,sourceIds:r})}h.status="sent",t().addMessage(u.id.toString(),h);const i=(0,n.KU)();l.v.info("MESSAGES","Starting message stream",{agentId:g.id,sessionId:u.session_id,messageContent:s.substring(0,50),hasSourceIds:r.length>0,sourceIds:r});try{const a={prompt:s||""};r.length>0&&(a.source_ids=r,s.trim()||(a.prompt="Please analyze the uploaded file(s).")),await i.sendMessageStream(g.id,u.session_id,a,s=>{if(l.v.info("MESSAGES","Received stream chunk",{type:s.type,hasContent:!!s.content,contentLength:s.content?.length,contentPreview:s.content?.substring(0,50)}),"content"===s.type&&s.content)t().updateStreamingMessage(s.content,s.citations);else if("citation"===s.type&&s.citations){const a=t().streamingMessage;a&&s.citations&&Array.isArray(s.citations)&&(s.citations.length>0&&"number"==typeof s.citations[0]?m(s.citations,g.id).then(s=>{const a=t().streamingMessage;a&&e({streamingMessage:{...a,citations:s}})}):e({streamingMessage:{...a,citations:s.citations}}))}},async s=>{l.v.error("MESSAGES","Streaming failed, attempting fallback to non-streaming",s,{errorMessage:s.message,agentId:g.id,sessionId:u.session_id});try{l.v.info("MESSAGES","Using non-streaming fallback");const s=await i.sendMessage(g.id,u.session_id,{prompt:a.prompt,stream:!1,source_ids:a.source_ids}),n=t().streamingMessage;if(n&&s){let e;if(e=s.data?s.data:s,n.content=e?.openai_response||e?.content||"No response received",e?.citations&&Array.isArray(e.citations)&&e.citations.length>0?"number"==typeof e.citations[0]?n.citations=await m(e.citations,g.id):n.citations=e.citations:n.citations=[],n.status="sent",e?.id){n.id=`${e.id}-assistant`;const s=(t().messages.get(u.id.toString())||[]).filter(e=>"user"===e.role).pop();s&&s.id===h.id&&(s.id=`${e.id}-user`,t().addMessage(u.id.toString(),s))}n.details={user_id:e?.user_id,conversation_id:e?.conversation_id,updated_at:e?.updated_at,prompt_id:e?.id,metadata:e?.metadata?{user_ip:e.metadata.user_ip,user_agent:e.metadata.user_agent,external_id:e.metadata.external_id,request_source:e.metadata.request_source}:void 0},t().addMessage(u.id.toString(),n)}e({streamingMessage:null,isStreaming:!1}),l.v.info("MESSAGES","Fallback to non-streaming successful")}catch(s){l.v.error("MESSAGES","Both streaming and non-streaming failed",s);const a=t().streamingMessage;a&&(a.content="Sorry, I encountered an error while processing your message. Please try again.",a.status="error",t().addMessage(u.id.toString(),a));let n="Communication error";if(s.status)switch(s.status){case 429:n="You have exhausted your current query credits. Please contact customer service for assistance.";break;case 401:n="API Token is either missing or invalid";break;case 404:n="Agent or conversation not found";break;case 400:n="Invalid request format";break;default:n=s.message||`Error ${s.status}`}else s.message&&(n=s.message);e({streamingMessage:null,isStreaming:!1,error:n})}},async()=>{const s=t().streamingMessage;if(s){s.status="sent",t().addMessage(u.id.toString(),s),e({streamingMessage:null,isStreaming:!1});try{l.v.info("MESSAGES","Enriching streaming message with API data");const e=(0,n.KU)(),a=await e.getMessages(g.id,u.session_id);let r=[];if(a&&"object"==typeof a&&(a.data&&a.data.messages&&Array.isArray(a.data.messages.data)?r=a.data.messages.data:Array.isArray(a.data)?r=a.data:Array.isArray(a)?r=a:a.data&&Array.isArray(a.data.data)&&(r=a.data.data)),r.length>0){const e=r[r.length-1];if(e&&e.openai_response){s.id=`${e.id}-assistant`,s.timestamp=e.created_at||e.timestamp||s.timestamp,s.details={user_id:e.user_id,conversation_id:e.conversation_id,updated_at:e.updated_at,prompt_id:e.id,metadata:e.metadata?{user_ip:e.metadata.user_ip,user_agent:e.metadata.user_agent,external_id:e.metadata.external_id,request_source:e.metadata.request_source}:void 0};const a=(t().messages.get(u.id.toString())||[]).filter(e=>"user"===e.role).pop();a&&a.id===h.id&&e.user_query&&(a.id=`${e.id}-user`,a.timestamp=e.created_at||e.timestamp||a.timestamp,a.details={user_id:e.user_id,conversation_id:e.conversation_id,updated_at:e.updated_at,prompt_id:e.id,metadata:e.metadata?{user_ip:e.metadata.user_ip,user_agent:e.metadata.user_agent,external_id:e.metadata.external_id,request_source:e.metadata.request_source}:void 0},t().addMessage(u.id.toString(),a));const n=s.citations||[];if(e.citations&&Array.isArray(e.citations)&&e.citations.length>0)if("number"==typeof e.citations[0]){const t=await m(e.citations,g.id);s.citations=t}else s.citations=e.citations;else s.citations=n;e.response_feedback?.reaction&&(s.feedback="liked"===e.response_feedback.reaction?"like":"disliked"===e.response_feedback.reaction?"dislike":void 0),t().addMessage(u.id.toString(),s),l.v.info("MESSAGES","Successfully enriched streaming message with API data",{messageId:s.id,hasDetails:!!s.details,citationCount:s.citations?.length||0})}else l.v.info("MESSAGES","API message format mismatch, keeping original message")}else l.v.info("MESSAGES","No API messages found for enrichment")}catch(e){l.v.warn("MESSAGES","Failed to enrich streaming message, keeping basic version",e)}}})}catch(e){throw l.v.error("MESSAGES","Failed to setup streaming",e),e}}catch(s){l.v.error("MESSAGES","Failed to send message",s,{errorType:s instanceof Error?s.constructor.name:typeof s,errorMessage:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,status:s.status,agentId:g.id,conversationId:u.id,sessionId:u.session_id}),h.status="error",t().addMessage(u.id.toString(),h);let a="Failed to send message";if(s.status)switch(s.status){case 429:a="You have exhausted your current query credits. Please contact customer service for assistance.";break;case 401:a="API Token is either missing or invalid";break;case 403:const e=r.o.getState(),{currentAgent:t}=e;a=t&&!t.is_chat_active?"Agent is inactive - no documents uploaded. Please add documents to activate the agent.":"Access denied. You don't have permission to access this resource.";break;case 404:a="Agent or conversation not found";break;case 400:a="Invalid request format";break;case 500:a="Internal server error. Please try again later.";break;default:a=s.message||`Error ${s.status}`}else s.message&&(a=s.message);throw e({streamingMessage:null,isStreaming:!1,error:a,loading:!1}),s}},addMessage:(t,s)=>{e(e=>{const a=new Map(e.messages),n=a.get(t)||[],r=n.findIndex(e=>e.id===s.id);return r>=0?n[r]=s:n.push(s),a.set(t,n),u(t,n),{messages:a}})},updateStreamingMessage:(t,s)=>{e(e=>e.streamingMessage?{streamingMessage:{...e.streamingMessage,content:e.streamingMessage.content+t,citations:s||e.streamingMessage.citations}}:e)},clearMessages:t=>{e(e=>{if(t){const s=new Map(e.messages);return s.delete(t),{messages:s}}return{messages:new Map}})},updateMessageFeedback:async(e,s)=>{const a=r.o.getState(),o=i.w.getState(),{currentAgent:c}=a,{currentConversation:g}=o;if(!c||!g)return void l.v.warn("MESSAGES","Cannot update feedback - missing agent or conversation");const u=(t().messages.get(g.id.toString())||[]).find(t=>t.id===e);if(!u)return void l.v.warn("MESSAGES","Message not found for feedback update",{messageId:e});let m;if(u.details?.prompt_id)m=u.details.prompt_id;else{const e=u.id.match(/^(\d+)-/);e&&(m=parseInt(e[1]))}if(!m)return l.v.error("MESSAGES","Could not determine prompt ID for message",{messageId:e,details:u.details}),void d.oR.error("Unable to update feedback. Message ID not found.");const h=g.session_id;if(h)try{const e={...u,feedback:s};t().addMessage(g.id.toString(),e);const a=(0,n.KU)(),r="like"===s?"thumbs_up":"thumbs_down";l.v.info("MESSAGES","Updating message feedback",{projectId:c.id,sessionId:h,promptId:m,feedback:r});await a.updateMessageFeedback(c.id,h,m,{feedback:r});l.v.info("MESSAGES","Message feedback updated successfully"),d.oR.success("Thanks for your feedback!")}catch(e){l.v.error("MESSAGES","Failed to update message feedback",e),t().addMessage(g.id.toString(),u),401===e?.status?d.oR.error("Authentication failed. Please log in again."):404===e?.status?d.oR.error("Message not found."):d.oR.error("Failed to update feedback. Please try again.")}else l.v.error("MESSAGES","Conversation missing session_id",{conversationId:g.id})},getMessagesForConversation:e=>t().messages.get(e)||[],cancelStreaming:()=>{c.Hr.cancelAllStreams(),e({streamingMessage:null,isStreaming:!1})},loadMessages:async t=>{if("undefined"!=typeof window&&window.__customgpt_demo_mode)return l.v.info("MESSAGES","Skipping message load in demo mode",{conversationId:t}),void e(e=>{const s=new Map(e.messages);return s.has(t)||s.set(t,[]),{messages:s,loading:!1}});if(t.startsWith("conv_"))return l.v.info("MESSAGES","Skipping API load for local conversation",{conversationId:t}),void e(e=>{const s=new Map(e.messages);return s.has(t)||s.set(t,[]),{messages:s,loading:!1}});const s=r.o.getState(),a=i.w.getState(),{currentAgent:o}=s,{conversations:c}=a;if(!o)return void l.v.warn("MESSAGES","No current agent when loading messages",{conversationId:t});const d=c.find(e=>e.id.toString()===t);if(!d)return l.v.error("MESSAGES","Conversation not found in store",{conversationId:t,availableConversations:c.map(e=>e.id)}),void e(e=>{const s=new Map(e.messages);return s.has(t)||s.set(t,[]),{messages:s,loading:!1}});l.v.info("MESSAGES","Loading messages for conversation",{conversationId:t,sessionId:d.session_id,agentId:o.id,agentName:o.project_name}),e({loading:!0,error:null});try{const s=(0,n.KU)(),a=await s.getMessages(o.id,d.session_id);l.v.info("MESSAGES","Messages API response received",{conversationId:t,responseType:typeof a,hasData:!!a?.data,dataLength:Array.isArray(a?.data)?a.data.length:0});let r=[];a&&"object"==typeof a&&(a.data&&a.data.messages&&Array.isArray(a.data.messages.data)?r=a.data.messages.data:Array.isArray(a.data)?r=a.data:Array.isArray(a)?r=a:a.data&&Array.isArray(a.data.data)&&(r=a.data.data)),l.v.info("MESSAGES","Processing messages",{conversationId:t,messagesCount:r.length,messageTypes:r.map(e=>e.role||"unknown")});const i=[];if(Array.isArray(r))for(const e of r){const t=e.created_at||e.timestamp||(new Date).toISOString();if(e.user_query&&i.push({id:`${e.id}-user`||`user-${Math.random()}`,role:"user",content:e.user_query,timestamp:t,status:"sent",details:{user_id:e.user_id,conversation_id:e.conversation_id,updated_at:e.updated_at,prompt_id:e.id,metadata:e.metadata?{user_ip:e.metadata.user_ip,user_agent:e.metadata.user_agent,external_id:e.metadata.external_id,request_source:e.metadata.request_source}:void 0}}),e.openai_response){let s=[];e.citations&&Array.isArray(e.citations)&&e.citations.length>0&&(s="number"==typeof e.citations[0]?await m(e.citations,o.id):e.citations),i.push({id:`${e.id}-assistant`||`assistant-${Math.random()}`,role:"assistant",content:e.openai_response,citations:s,timestamp:t,status:"sent",feedback:"liked"===e.response_feedback?.reaction?"like":"disliked"===e.response_feedback?.reaction?"dislike":void 0,details:{user_id:e.user_id,conversation_id:e.conversation_id,updated_at:e.updated_at,prompt_id:e.id,metadata:e.metadata?{user_ip:e.metadata.user_ip,user_agent:e.metadata.user_agent,external_id:e.metadata.external_id,request_source:e.metadata.request_source}:void 0}})}}l.v.info("MESSAGES","Messages formatted successfully",{conversationId:t,formattedCount:i.length}),i.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),l.v.info("MESSAGES","Messages sorted by timestamp",{conversationId:t,firstMessageTime:i[0]?.timestamp,lastMessageTime:i[i.length-1]?.timestamp}),e(e=>{const s=new Map(e.messages),a=(e.messages.get(t)||[]).filter(e=>"sending"===e.status||"user"===e.role&&new Date(e.timestamp).getTime()>Date.now()-5e3),n=[...i];for(const e of a)if(!n.find(t=>t.id===e.id)){const t=n.findIndex(t=>new Date(t.timestamp).getTime()>new Date(e.timestamp).getTime());-1===t?n.push(e):n.splice(t,0,e)}return s.set(t,n),u(t,n),{messages:s,loading:!1}})}catch(s){l.v.error("MESSAGES","Failed to load messages",s,{conversationId:t,agentId:o.id,errorType:s instanceof Error?s.constructor.name:typeof s,status:s?.status,message:s?.message});const a=function(e){try{const t=localStorage.getItem(g);return t&&JSON.parse(t)[e]||null}catch(e){return null}}(t);a&&a.length>0?(l.v.info("MESSAGES","Using cached messages as fallback",{conversationId:t,messageCount:a.length}),a.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),e(e=>{const s=new Map(e.messages);return s.set(t,a),{messages:s,loading:!1,error:"Using cached messages (API unavailable)"}})):e({error:s instanceof Error?s.message:"Failed to load messages",loading:!1})}}}))},3016:(e,t,s)=>{"use strict";s.r(t),s.d(t,{cleanupStores:()=>S,initializeStores:()=>j,useAgentStore:()=>i.o,useAnalyticsStore:()=>h,useConfigStore:()=>r,useConversationStore:()=>o.w,useLicenseStore:()=>b,useMessageStore:()=>c.o,usePageStore:()=>p,useProfileStore:()=>x,useProjectSettingsStore:()=>y,useSourceStore:()=>f,useUIStore:()=>l});var a=s(1446),n=s(5189);const r=(0,a.vt)()((0,n.Zr)((e,t)=>({apiKey:null,baseURL:"https://app.customgpt.ai/api/v1",theme:"light",setApiKey:e=>{},setBaseURL:e=>{},setTheme:t=>{e({theme:t}),"undefined"!=typeof window&&(document.documentElement.className=t)}}),{name:"customgpt-config",partialize:e=>({theme:e.theme}),onRehydrateStorage:()=>e=>{e?.theme&&"undefined"!=typeof window&&(document.documentElement.className=e.theme)}}));var i=s(7292),o=s(7648),c=s(1582);const l=(0,a.vt)()((0,n.Zr)(e=>({sidebarOpen:!0,settingsOpen:!1,theme:"light",fontSize:"md",setSidebarOpen:t=>{e({sidebarOpen:t})},setSettingsOpen:t=>{e({settingsOpen:t})},setTheme:t=>{e({theme:t}),"undefined"!=typeof window&&(document.documentElement.className=t)},setFontSize:t=>{if(e({fontSize:t}),"undefined"!=typeof window){const e=document.documentElement;switch(e.classList.remove("text-sm","text-base","text-lg"),t){case"sm":e.classList.add("text-sm");break;case"lg":e.classList.add("text-lg");break;default:e.classList.add("text-base")}}}}),{name:"customgpt-ui",partialize:e=>({sidebarOpen:e.sidebarOpen,theme:e.theme,fontSize:e.fontSize}),onRehydrateStorage:()=>e=>{if("undefined"!=typeof window&&e){document.documentElement.className=e.theme;const t=document.documentElement;switch(t.classList.remove("text-sm","text-base","text-lg"),e.fontSize){case"sm":t.classList.add("text-sm");break;case"lg":t.classList.add("text-lg");break;default:t.classList.add("text-base")}}}}));var d=s(4267),g=s(1681);const u=e=>e.toISOString().split("T")[0],m=()=>{const e=new Date,t=new Date;return t.setDate(t.getDate()-30),{startDate:u(t),endDate:u(e)}},h=(0,a.vt)((e,t)=>({analytics:null,loading:!1,error:null,dateRange:m(),fetchAnalytics:async t=>{e({loading:!0,error:null});try{const s=(0,d.KU)(),[a,n,r,i]=await Promise.all([s.getTrafficReport(t),s.getQueriesReport(t),s.getConversationsReport(t),s.getAnalysisReport(t,"daily")]),o={conversations:{total:r.data?.total||0,active:Math.floor(.7*(r.data?.total||0)),trend:0,data:i.data?.conversations?.map(e=>({date:e.created_at_interval,count:Number(e.queries_number)||0}))||[]},queries:{total:n.data?.total||0,successful:n.data?.query_status?.find(e=>"success"===e.status)?.count||0,failed:n.data?.query_status?.find(e=>"failed"===e.status)?.count||0,avgResponseTime:0,topQueries:[],data:i.data?.queries?.map(e=>({date:e.created_at_interval,count:Number(e.queries_number)||0}))||[]},traffic:{uniqueUsers:a.data?.sources?.reduce((e,t)=>e+(t.request_source_number||0),0)||0,pageViews:a.data?.sources?.reduce((e,t)=>e+(t.request_source_number||0),0)||0,avgSessionDuration:0,bounceRate:0,data:a.data?.sources?.map(e=>({date:(new Date).toISOString().split("T")[0],users:e.request_source_number||0,pageViews:e.request_source_number||0}))||[]},statistics:{totalMessages:n.data?.total||0,totalConversations:r.data?.total||0,avgMessagesPerConversation:Number(r.data?.average_queries_per_conversation)||0,satisfactionRate:0,responseAccuracy:0}};e({analytics:o,loading:!1})}catch(t){let s="Failed to fetch analytics";401===t.status?(s="Authentication required. Please log in again.",g.oR.error("Your session has expired. Please log in again.")):404===t.status?(s="Analytics data not found for this project.",g.oR.error("No analytics data available yet.")):500===t.status?(s="Server error occurred. Please try again later.",g.oR.error("Server error. Please try again later.")):g.oR.error("Failed to fetch analytics data"),e({analytics:null,error:s,loading:!1})}},setDateRange:(t,s)=>{e({dateRange:{startDate:t,endDate:s}})},exportAnalytics:async e=>{const s=t().analytics;if(s)try{switch(e){case"json":const e=JSON.stringify(s,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`analytics-${(new Date).toISOString()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),g.oR.success("Analytics exported successfully");break;case"csv":g.oR.info("CSV export not yet implemented");break;case"pdf":g.oR.info("PDF export not yet implemented")}}catch(e){g.oR.error("Failed to export analytics")}else g.oR.error("No analytics data to export")},reset:()=>{e({analytics:null,loading:!1,error:null,dateRange:m()})}})),p=(0,a.vt)((e,t)=>({pages:[],loading:!1,error:null,paginationInfo:{current_page:1,total:0,per_page:20,last_page:1},queryParams:{page:1,limit:20,order:"desc",crawl_status:"all",index_status:"all"},fetchPages:async s=>{if((0,d.uQ)()){e({loading:!0,error:null});try{const a=(0,d.KU)(),{queryParams:n}=t(),r=await a.getPages(s,n);e({pages:r.data.pages.data,paginationInfo:{current_page:r.data.pages.current_page,total:r.data.pages.total,per_page:r.data.pages.per_page,last_page:r.data.pages.last_page},loading:!1})}catch(t){let s="Failed to fetch pages";400===t.status?s="Invalid request. Please check the project ID.":401===t.status?s="Authentication failed. Please log in again.":404===t.status?s="Project not found.":500===t.status&&(s="Server error. Please try again later."),e({error:s,loading:!1}),g.oR.error(s)}}else e({error:"API client not initialized"})},deletePage:async(t,s)=>{if((0,d.uQ)()){e({loading:!0,error:null});try{const a=(0,d.KU)();await a.deletePage(t,s),e(e=>({pages:e.pages.filter(e=>e.id!==s),loading:!1})),g.oR.success("Page deleted successfully")}catch(t){let s="Failed to delete page";401===t.status?s="Authentication failed. Please log in again.":404===t.status&&(s="Page not found."),e({error:s,loading:!1}),g.oR.error(s)}}else g.oR.error("API client not initialized")},reindexPage:async(t,s)=>{if((0,d.uQ)()){e({loading:!0,error:null});try{const a=(0,d.KU)();await a.reindexPage(t,s),e(e=>({pages:e.pages.map(e=>e.id===s?{...e,crawl_status:"queued",index_status:"queued"}:e),loading:!1})),g.oR.success("Page reindexing started")}catch(t){let s="Failed to reindex page";401===t.status?s="Authentication failed. Please log in again.":403===t.status&&(s="The page could not be reindexed."),e({error:s,loading:!1}),g.oR.error(s)}}else g.oR.error("API client not initialized")},setQueryParams:t=>{e(e=>({queryParams:{...e.queryParams,...t}}))},reset:()=>{e({pages:[],loading:!1,error:null,paginationInfo:{current_page:1,total:0,per_page:20,last_page:1},queryParams:{page:1,limit:20,order:"desc",crawl_status:"all",index_status:"all"}})}})),f=(0,a.vt)((e,t)=>({sources:[],currentSource:null,loading:!1,error:null,searchQuery:"",filter:{status:"all",type:"all",sortBy:"updated_at",sortOrder:"desc"},syncStatus:{syncing:!1},fetchSources:async t=>{e({loading:!0,error:null});try{const s=(0,d.KU)(),a=await s.getSources(t),n=[];if(a.data.sitemaps&&a.data.sitemaps.forEach(e=>{n.push({id:e.id.toString(),project_id:t,name:e.settings.sitemap_path||`Source ${e.id}`,type:"url",status:"active",metadata:{...e.settings,pages:e.pages},created_at:e.created_at,updated_at:e.updated_at})}),a.data.uploads){(Array.isArray(a.data.uploads)?a.data.uploads:[a.data.uploads]).forEach(e=>{n.push({id:e.id.toString(),project_id:t,name:`Upload ${e.id}`,type:"file",status:"active",metadata:{...e.settings,pages:e.pages},created_at:e.created_at,updated_at:e.updated_at})})}e({sources:n,loading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch sources",loading:!1}),g.oR.error("Failed to load sources")}},fetchSource:async(t,s)=>{e({loading:!0,error:null});try{throw new Error("getSource API method not available")}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch source",loading:!1}),g.oR.error("Failed to load source details")}},uploadSources:async(s,a)=>{e({loading:!0,error:null});try{(0,d.KU)();const n=a.map(e=>Promise.reject(new Error("uploadFile API method not available")));await Promise.all(n);await t().fetchSources(s),g.oR.success(`Successfully uploaded ${a.length} file(s)`),e({loading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"Failed to upload sources",loading:!1}),g.oR.error("Failed to upload files"),t}},updateSource:async(t,s,a)=>{e({loading:!0,error:null});try{(0,d.KU)();throw new Error("updateSource API method not available")}catch(t){throw e({error:t instanceof Error?t.message:"Failed to update source",loading:!1}),g.oR.error("Failed to update source"),t}},deleteSource:async(t,s)=>{e({loading:!0,error:null});try{const a=(0,d.KU)();await a.deleteSource(t,parseInt(s)),e(e=>({sources:e.sources.filter(e=>e.id!==s),currentSource:e.currentSource?.id===s?null:e.currentSource,loading:!1})),g.oR.success("Source deleted successfully")}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete source",loading:!1}),g.oR.error("Failed to delete source"),t}},bulkDelete:async(t,s)=>{e({loading:!0,error:null});try{const a=(0,d.KU)();await Promise.all(s.map(e=>a.deleteSource(t,parseInt(e)))),e(e=>({sources:e.sources.filter(e=>!s.includes(e.id)),currentSource:s.includes(e.currentSource?.id||"")?null:e.currentSource,loading:!1})),g.oR.success(`Successfully deleted ${s.length} source(s)`)}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete sources",loading:!1}),g.oR.error("Failed to delete sources"),t}},syncSources:async t=>{e(e=>({syncStatus:{...e.syncStatus,syncing:!0,progress:0}}));try{(0,d.KU)();throw new Error("syncSources API method not available")}catch(t){throw e(e=>({syncStatus:{...e.syncStatus,syncing:!1},error:t instanceof Error?t.message:"Failed to sync sources"})),g.oR.error("Failed to sync sources"),t}},setSearchQuery:t=>{e({searchQuery:t})},setFilter:t=>{e(e=>({filter:{...e.filter,...t}}))},selectSource:t=>{e({currentSource:t})},reset:()=>{e({sources:[],currentSource:null,loading:!1,error:null,searchQuery:"",filter:{status:"all",type:"all",sortBy:"updated_at",sortOrder:"desc"},syncStatus:{syncing:!1}})}})),x=(0,a.vt)()((0,n.Zr)((e,t)=>({profile:null,loading:!1,error:null,fetchProfile:async()=>{e({loading:!0,error:null});try{const t=(0,d.KU)(),s=await t.getUserProfile();if("success"!==s.status)throw new Error("Failed to fetch profile");e({profile:s.data,loading:!1})}catch(t){let s="Failed to fetch profile";401===t.status?(s="Authentication required. Please log in again.",g.oR.error("Your session has expired. Please log in again.")):500===t.status?(s="Server error occurred. Please try again later.",g.oR.error("Server error. Please try again later.")):g.oR.error("Failed to load profile"),e({error:s,loading:!1})}},updateProfile:async(t,s)=>{e({loading:!0,error:null});try{const a=(0,d.KU)(),n=new FormData;n.append("name",t),s&&n.append("profile_photo",s);const r=await a.updateUserProfile(n);if("success"!==r.status)throw new Error("Failed to update profile");e({profile:r.data,loading:!1}),g.oR.success("Profile updated successfully")}catch(t){let s="Failed to update profile";401===t.status?(s="Authentication required. Please log in again.",g.oR.error("Your session has expired. Please log in again.")):500===t.status?(s="Server error occurred. Please try again later.",g.oR.error("Server error. Please try again later.")):g.oR.error("Failed to update profile"),e({error:s,loading:!1})}},reset:()=>{e({profile:null,loading:!1,error:null})}}),{name:"profile-store",partialize:e=>({profile:e.profile})})),v=new Map,y=(0,a.vt)((e,t)=>({settings:null,settingsLoading:!1,settingsError:null,plugins:[],pluginsLoading:!1,pluginsError:null,stats:null,statsLoading:!1,statsError:null,fetchSettings:async t=>{const s=`settings-${t}`;if(!v.get(s)){v.set(s,!0),e({settingsLoading:!0,settingsError:null});try{const s=await(0,d.KU)().getAgentSettings(t);if(s&&s.data)e({settings:s.data,settingsLoading:!1,settingsError:null});else{if(!s)throw new Error("Failed to fetch project settings");e({settings:s,settingsLoading:!1,settingsError:null})}}catch(t){const s=t instanceof Error?t.message:"Failed to fetch project settings";e({settingsError:s,settingsLoading:!1}),t instanceof Error&&!t.message.includes("404")&&g.oR.error(s)}finally{v.delete(s)}}},updateSettings:async(s,a)=>{e({settingsLoading:!0,settingsError:null});try{const n=new FormData;Object.entries(a).forEach(([e,t])=>{null!=t&&("example_questions"===e&&Array.isArray(t)?t.forEach(e=>{n.append("example_questions[]",e)}):t instanceof File?n.append(e,t):n.append(e,String(t)))});if(!await(0,d.KU)().updateAgentSettings(s,n))throw new Error("Failed to update project settings");e({settingsLoading:!1}),await t().fetchSettings(s),g.oR.success("Project settings updated successfully")}catch(t){const s=t instanceof Error?t.message:"Failed to update project settings";e({settingsError:s,settingsLoading:!1}),g.oR.error(s)}},fetchPlugins:async t=>{e({pluginsLoading:!0,pluginsError:null});try{const s=await(0,d.KU)().getProjectPlugins(t);if(!s)throw new Error("Failed to fetch project plugins");{const t=s.data||s;e({plugins:Array.isArray(t)?t:[],pluginsLoading:!1})}}catch(t){const s=t instanceof Error?t.message:"Failed to fetch project plugins";e({pluginsError:s,pluginsLoading:!1,plugins:[]})}},updatePlugin:async(s,a,n)=>{try{if(!await(0,d.KU)().updateProjectPlugin(s,a,{enabled:n}))throw new Error("Failed to update plugin");{const s=t().plugins.map(e=>e.id===a?{...e,enabled:n}:e);e({plugins:s}),g.oR.success(`Plugin ${n?"enabled":"disabled"} successfully`)}}catch(e){const t=e instanceof Error?e.message:"Failed to update plugin";g.oR.error(t)}},fetchStats:async t=>{e({statsLoading:!0,statsError:null});try{const s=await(0,d.KU)().getAgentStats(t);if(!s)throw new Error("Failed to fetch project stats");{const t=s.data||s;e({stats:t,statsLoading:!1})}}catch(t){const s=t instanceof Error?t.message:"Failed to fetch project stats";e({statsError:s,statsLoading:!1}),g.oR.error(s)}},reset:()=>{e({settings:null,settingsLoading:!1,settingsError:null,plugins:[],pluginsLoading:!1,pluginsError:null,stats:null,statsLoading:!1,statsError:null})}}));var w=s(5772);const b=(0,a.vt)((e,t)=>({licenses:[],loading:!1,error:null,fetchLicenses:async t=>{e({loading:!0,error:null});try{const s=(0,d.KU)(),a=await s.getLicenses(t);w.v.info("LICENSES","API Response",{projectId:t,status:"success",responseType:typeof a,hasData:!!a?.data,dataType:Array.isArray(a?.data)?"array":typeof a?.data,dataLength:Array.isArray(a?.data)?a.data.length:0,fullResponse:a});const n=Array.isArray(a.data)?a.data:[];w.v.info("LICENSES","Processed licenses",{count:n.length,licenses:n.map(e=>({name:e.name,key:e.key?.substring(0,8)+"...",project_id:e.project_id}))}),e({licenses:n,loading:!1})}catch(s){w.v.error("LICENSES","Failed to fetch licenses",{projectId:t,errorType:s?.constructor?.name,errorMessage:s?.message,errorStatus:s?.status,errorCode:s?.code,fullError:s});const a=s instanceof Error?s.message:"Failed to fetch licenses";e({error:a,loading:!1,licenses:[]})}},createLicense:async(t,s)=>{e({loading:!0,error:null}),w.v.info("LICENSES","Creating license",{projectId:t,name:s});try{const a=(0,d.KU)(),n=await a.createLicense(t,{name:s});w.v.info("LICENSES","Create license API response",{projectId:t,name:s,status:"success",responseType:typeof n,hasData:!!n?.data,dataStructure:n?.data?Object.keys(n.data):[],licenseKey:n.data?.licenseKey?.substring(0,8)+"...",fullResponse:n});const r=n.data?.license||n.data;return r&&(w.v.info("LICENSES","New license created",{licenseName:r.name,licenseKey:r.key?.substring(0,8)+"...",project_id:r.project_id}),e(e=>({licenses:[...e.licenses,r],loading:!1}))),r}catch(a){w.v.error("LICENSES","Failed to create license",{projectId:t,name:s,errorType:a?.constructor?.name,errorMessage:a?.message,errorStatus:a?.status,errorCode:a?.code,fullError:a});const n=a instanceof Error?a.message:"Failed to create license";throw e({error:n,loading:!1}),a}},updateLicense:async(t,s,a)=>{e({loading:!0,error:null});try{const n=(0,d.KU)(),r=await n.updateLicense(t,s,{name:a});w.v.info("LICENSES","Updated license",{projectId:t,licenseId:s,name:a});(r.license||r.data)&&e(e=>({licenses:e.licenses.map(e=>e.key===s?{...e,name:a,updated_at:(new Date).toISOString()}:e),loading:!1}))}catch(t){w.v.error("LICENSES","Failed to update license",t);const s=t instanceof Error?t.message:"Failed to update license";throw e({error:s,loading:!1}),t}},deleteLicense:async(t,s)=>{e({loading:!0,error:null});try{const a=(0,d.KU)();await a.deleteLicense(t,s),w.v.info("LICENSES","Deleted license",{projectId:t,licenseId:s}),e(e=>({licenses:e.licenses.filter(e=>e.key!==s),loading:!1}))}catch(t){w.v.error("LICENSES","Failed to delete license",t);const s=t instanceof Error?t.message:"Failed to delete license";throw e({error:s,loading:!1}),t}},clearError:()=>{e({error:null})}}));function j(){}function S(){}},3345:(e,t,s)=>{"use strict";s.d(t,{Hr:()=>i});var a=s(7047);function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e={}){n(this,"config",void 0),n(this,"abortController",null),n(this,"currentMessage",null),this.config={timeout:e.timeout||6e4,retryAttempts:e.retryAttempts||3,retryDelay:e.retryDelay||1e3}}async processStream(e,t){this.abortController=new AbortController,this.currentMessage={id:this.generateId(),content:"",citations:[],isComplete:!1};const s=e.getReader(),a=new TextDecoder;let n="";const r=setTimeout(()=>{this.cancel(),t.onError?.(new Error("Stream timeout"))},this.config.timeout);try{for(;;){const{done:e,value:r}=await s.read();if(e){this.currentMessage.isComplete=!0,t.onComplete?.();break}n+=a.decode(r,{stream:!0});const i=n.split("\n");n=i.pop()||"";for(const e of i)e.trim()&&await this.processLine(e,t)}}catch(e){e instanceof Error&&"AbortError"===e.name?t.onError?.(new Error("Stream cancelled")):t.onError?.(e instanceof Error?e:new Error("Unknown streaming error"))}finally{clearTimeout(r),s.releaseLock(),this.abortController=null}return this.currentMessage}async processLine(e,t){const s=(0,a.RW)(e);if(s&&this.currentMessage)switch(s.type){case"content":s.content&&(this.currentMessage.content+=s.content,t.onChunk?.(s.content));break;case"citation":s.citations&&(this.currentMessage.citations.push(...s.citations),s.citations.forEach(e=>{t.onCitation?.(e)}));break;case"done":return this.currentMessage.isComplete=!0,void t.onComplete?.();case"error":return void t.onError?.(new Error(s.error||"Stream error"))}}cancel(){this.abortController&&this.abortController.abort()}getCurrentMessage(){return this.currentMessage}isStreaming(){return null!==this.abortController&&null!==this.currentMessage&&!this.currentMessage.isComplete}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}}const i=new class{constructor(e=3){n(this,"streams",new Map),n(this,"maxConcurrentStreams",void 0),this.maxConcurrentStreams=e}async startStream(e,t,s,a){if(this.streams.size>=this.maxConcurrentStreams)throw new Error(`Maximum concurrent streams (${this.maxConcurrentStreams}) reached`);this.streams.has(e)&&this.cancelStream(e);const n=new r(a);this.streams.set(e,n);try{return await n.processStream(t,{...s,onComplete:()=>{this.streams.delete(e),s.onComplete?.()},onError:t=>{this.streams.delete(e),s.onError?.(t)}})}catch(t){throw this.streams.delete(e),t}}cancelStream(e){const t=this.streams.get(e);t&&(t.cancel(),this.streams.delete(e))}cancelAllStreams(){this.streams.forEach(e=>e.cancel()),this.streams.clear()}getActiveStreams(){return Array.from(this.streams.keys())}getStreamStatus(e){const t=this.streams.get(e);return t?{exists:!0,isStreaming:t.isStreaming(),message:t.getCurrentMessage()}:{exists:!1,isStreaming:!1,message:null}}getActiveStreamCount(){return this.streams.size}}},4267:(e,t,s)=>{"use strict";s.d(t,{KU:()=>o,uQ:()=>c});var a=s(7047),n=s(5772);function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const i=new class{constructor(){r(this,"baseURL","/api/proxy"),r(this,"timeout",3e4),r(this,"abortControllers",new Map),n.v.info("PROXY_CLIENT","Proxy API Client initialized",{baseURL:this.baseURL,timeout:this.timeout})}async request(e,t={}){const s=`${this.baseURL}${e}`,a=`${t.method||"GET"}-${e}-${Date.now()}`;n.v.apiRequest(e,t.method||"GET",t.body);try{const r=new AbortController;this.abortControllers.set(a,r);const i=setTimeout(()=>{r.abort()},this.timeout),o=t.body instanceof FormData?{...t.headers||{}}:{"Content-Type":"application/json",...t.headers||{}},c=await fetch(s,{...t,headers:o,signal:r.signal});clearTimeout(i),this.abortControllers.delete(a);const l=await c.json();if(!c.ok)throw{message:l.error||`Request failed with status ${c.status}`,status:c.status,data:l};return n.v.apiResponse(e,c.status,l),l}catch(t){if(this.abortControllers.delete(a),"AbortError"===t.name)throw n.v.apiError(e,{message:"Request timeout",code:"TIMEOUT"}),new Error("Request timeout");throw n.v.apiError(e,t),t}}async streamRequest(e,t={}){const s=`${this.baseURL}${e}`;n.v.apiRequest(e,"POST-STREAM",t.body);const a=await fetch(s,{...t,headers:{"Content-Type":"application/json",Accept:"text/event-stream",...t.headers}});if(!a.ok){const t=await a.text();throw n.v.apiError(e,{message:t,status:a.status}),new Error(`Stream request failed: ${a.status}`)}return n.v.apiResponse(e,a.status,"Stream started"),a.body}cancelRequest(e,t="GET"){Array.from(this.abortControllers.entries()).forEach(([s,a])=>{s.includes(`${t}-${e}`)&&(a.abort(),this.abortControllers.delete(s))})}cancelAllRequests(){this.abortControllers.forEach(e=>e.abort()),this.abortControllers.clear()}async getAgents(e){const t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.per_page&&t.append("per_page",e.per_page.toString());const s=t.toString();return this.request("/projects"+(s?`?${s}`:""))}async createAgent(e){return this.request("/projects",{method:"POST",body:JSON.stringify(e)})}async getAgent(e){return this.request(`/projects/${e}`)}async updateAgent(e,t){const s=new FormData;return Object.entries(t).forEach(([e,t])=>{void 0!==t&&s.append(e,String(t))}),this.request(`/projects/${e}`,{method:"POST",body:s})}async deleteAgent(e){return this.request(`/projects/${e}`,{method:"DELETE"})}async replicateAgent(e){return this.request(`/projects/${e}/replicate`,{method:"POST"})}async getAgentStats(e){return this.request(`/projects/${e}/stats`)}async getAgentSettings(e){return this.request(`/projects/${e}/settings`)}async updateAgentSettings(e,t){const s=t instanceof FormData;return this.request(`/projects/${e}/settings`,{method:"POST",body:s?t:JSON.stringify(t),headers:s?{}:{"Content-Type":"application/json"}})}async getProjectPlugins(e){return this.request(`/projects/${e}/plugins`)}async updateProjectPlugin(e,t,s){return this.request(`/projects/${e}/plugins/${t}`,{method:"PUT",body:JSON.stringify(s)})}async getConversations(e,t){const s=new URLSearchParams;t?.page&&s.append("page",t.page.toString()),t?.per_page&&s.append("per_page",t.per_page.toString()),t?.order&&s.append("order",t.order),t?.orderBy&&s.append("orderBy",t.orderBy),t?.userFilter&&s.append("userFilter",t.userFilter);const a=s.toString();return this.request(`/projects/${e}/conversations${a?`?${a}`:""}`)}async createConversation(e,t){return this.request(`/projects/${e}/conversations`,{method:"POST",body:JSON.stringify(t||{})})}async updateConversation(e,t,s){return this.request(`/projects/${e}/conversations/${t}`,{method:"PUT",body:JSON.stringify(s)})}async deleteConversation(e,t){return this.request(`/projects/${e}/conversations/${t}`,{method:"DELETE"})}async getMessages(e,t,s){const a=new URLSearchParams;s?.page&&a.append("page",s.page.toString()),s?.per_page&&a.append("per_page",s.per_page.toString());const n=a.toString();return this.request(`/projects/${e}/conversations/${t}/messages${n?`?${n}`:""}`)}async sendMessage(e,t,s){return this.request(`/projects/${e}/conversations/${t}/messages`,{method:"POST",body:JSON.stringify(s)})}async sendMessageStream(e,t,s,n,r,i){try{const r=(await this.streamRequest(`/projects/${e}/conversations/${t}/messages`,{method:"POST",body:JSON.stringify({...s,stream:!0})})).getReader(),o=new TextDecoder;let c="";for(;;){const{done:e,value:t}=await r.read();if(e){i?.();break}c+=o.decode(t,{stream:!0});const s=c.split("\n");c=s.pop()||"";for(const e of s)if(e.startsWith("data: "))try{const t=e.slice(6);if("[DONE]"===t)return void i?.();const s=(0,a.RW)(t);s&&n(s)}catch(e){}}}catch(e){throw r?.(e),e}}async getMessageById(e,t,s){return this.request(`/projects/${e}/conversations/${t}/messages/${s}`)}async updateMessageFeedback(e,t,s,a){return this.request(`/projects/${e}/conversations/${t}/messages/${s}/feedback`,{method:"PUT",body:JSON.stringify(a)})}async getCitation(e,t){return this.request(`/projects/${e}/citations/${t}`)}async previewCitationFile(e){return this.request(`/preview/${e}`)}async uploadFile(e,t,s){const a=new FormData;return a.append("file",t),this.request(`/projects/${e}/sources`,{method:"POST",body:a,headers:{}})}async getTrafficReport(e){return this.request(`/projects/${e}/reports/traffic`)}async getQueriesReport(e){return this.request(`/projects/${e}/reports/queries`)}async getConversationsReport(e){return this.request(`/projects/${e}/reports/conversations`)}async getAnalysisReport(e,t){const s=new URLSearchParams;t&&s.append("interval",t);const a=s.toString();return this.request(`/projects/${e}/reports/analysis${a?`?${a}`:""}`)}async getPages(e,t){const s=new URLSearchParams;t?.page&&s.append("page",t.page.toString()),t?.limit&&s.append("limit",t.limit.toString()),t?.order&&s.append("order",t.order),t?.crawl_status&&s.append("crawl_status",t.crawl_status),t?.index_status&&s.append("index_status",t.index_status);const a=s.toString();return this.request(`/projects/${e}/pages${a?`?${a}`:""}`)}async deletePage(e,t){return this.request(`/projects/${e}/pages/${t}`,{method:"DELETE"})}async reindexPage(e,t){return this.request(`/projects/${e}/pages/${t}/reindex`,{method:"POST"})}async getPageMetadata(e,t){return this.request(`/projects/${e}/pages/${t}/metadata`)}async updatePageMetadata(e,t,s){return this.request(`/projects/${e}/pages/${t}/metadata`,{method:"PUT",body:JSON.stringify(s)})}async getLicenses(e){return this.request(`/projects/${e}/licenses`)}async createLicense(e,t){return this.request(`/projects/${e}/licenses`,{method:"POST",body:JSON.stringify(t)})}async getLicense(e,t){return this.request(`/projects/${e}/licenses/${t}`)}async updateLicense(e,t,s){return this.request(`/projects/${e}/licenses/${t}`,{method:"PUT",body:JSON.stringify(s)})}async deleteLicense(e,t){return this.request(`/projects/${e}/licenses/${t}`,{method:"DELETE"})}async getSources(e){return this.request(`/projects/${e}/sources`)}async createSitemapSource(e,t){const s=new FormData;return s.append("sitemap_path",t.sitemap_path),void 0!==t.executive_js&&s.append("executive_js",String(t.executive_js)),void 0!==t.data_refresh_frequency&&s.append("data_refresh_frequency",t.data_refresh_frequency),void 0!==t.create_new_pages&&s.append("create_new_pages",String(t.create_new_pages)),void 0!==t.remove_unexist_pages&&s.append("remove_unexist_pages",String(t.remove_unexist_pages)),void 0!==t.refresh_existing_pages&&s.append("refresh_existing_pages",t.refresh_existing_pages),this.request(`/projects/${e}/sources`,{method:"POST",body:s,headers:{}})}async uploadFileSource(e,t){return this.request(`/projects/${e}/sources`,{method:"POST",body:t,headers:{}})}async updateSourceSettings(e,t,s){return this.request(`/projects/${e}/sources/${t}`,{method:"PUT",body:JSON.stringify(s)})}async deleteSource(e,t){return this.request(`/projects/${e}/sources/${t}`,{method:"DELETE"})}async instantSyncSource(e,t){return this.request(`/projects/${e}/sources/${t}/instant-sync`,{method:"PUT"})}async getUserLimits(){return this.request("/user/limits")}async getUserProfile(){return this.request("/user")}async updateUserProfile(e){return this.request("/user",{method:"POST",body:e,headers:{}})}};function o(){return i}function c(){return!0}},4784:(e,t,s)=>{"use strict";s.d(t,{default:()=>ls});var a=s(758),n=s(9576),r=s(1681),i=s(3016),o=s(2221),c=s(9033),l=s(7047),d=s(9400),g=s(9014),u=s(8080),m=s(3498),h=s(578),p=s(4347),f=s(8589),x=s(5368),v=s(2012),y=s(846),w=s(6070);const b=(0,y.F)("inline-flex items-center justify-center rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 py-2 px-4",sm:"h-8 px-3 text-xs",lg:"h-12 px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=a.forwardRef(({className:e,variant:t,size:s,asChild:a=!1,...n},r)=>(0,w.jsx)("button",{className:(0,l.cn)(b({variant:t,size:s,className:e})),ref:r,...n}));j.displayName="Button";var S=s(8637);const N={xs:{container:"w-4 h-4",icon:"w-2 h-2"},sm:{container:"w-6 h-6",icon:"w-3 h-3"},md:{container:"w-8 h-8",icon:"w-4 h-4"},lg:{container:"w-10 h-10",icon:"w-5 h-5"},xl:{container:"w-12 h-12",icon:"w-6 h-6"}},C={circle:"rounded-full",rounded:"rounded-lg",square:"rounded-none"},_=({agent:e,src:t,alt:s,size:n="md",shape:r="circle",fallback:i="bot",isSelected:o=!1,className:d})=>{const[g,u]=a.useState(!1),m=t||e?.settings?.chatbot_avatar,h=s||(e?.project_name?`${e.project_name} avatar`:"Avatar"),p=N[n],f=C[r],x=o?"bg-brand-600":"bg-gray-200 hover:bg-gray-300 transition-colors";a.useEffect(()=>{u(!1)},[m]);return(0,w.jsx)("div",{className:(0,l.cn)("flex items-center justify-center flex-shrink-0 overflow-hidden",p.container,f,x,d),children:m&&!g?(0,w.jsx)("img",{src:m,alt:h,className:"w-full h-full object-cover",onError:()=>{u(!0)},loading:"lazy"}):(()=>{if("none"===i)return null;const e=(0,l.cn)(p.icon,o?"text-white":"text-gray-600");return"user"===i?(0,w.jsx)(S.A,{className:e}):(0,w.jsx)(c.A,{className:e})})()})},A=({agent:e,size:t="md",isSelected:s=!1,className:a})=>(0,w.jsx)(_,{agent:e,size:t,shape:"circle",fallback:"bot",isSelected:s,alt:e?.project_name?`${e.project_name} avatar`:"Agent avatar",className:a}),E=({src:e,size:t="md",className:s})=>(0,w.jsx)(_,{src:e,size:t,shape:"circle",fallback:"user",alt:"User avatar",className:s});var I=s(9716),k=s(1912),M=s(9666),P=s(4712);const R=({citation:e,index:t,isExpanded:s,onToggle:a,onClick:n,onPreviewClick:r})=>(0,w.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden transition-all hover:border-gray-300",children:[(0,w.jsxs)("button",{onClick:a,className:"w-full px-3 py-2 flex items-center gap-3 hover:bg-gray-50 transition-colors text-left",children:[(0,w.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded bg-brand-100 flex items-center justify-center",children:(0,w.jsx)("span",{className:"text-xs font-medium text-brand-700",children:t})}),(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,w.jsx)("div",{className:"font-medium text-sm text-gray-900 line-clamp-1",children:e.title}),(0,w.jsx)("div",{className:"text-xs text-gray-500 line-clamp-1",children:e.source||e.url})]}),(0,w.jsx)(k.A,{className:(0,l.cn)("w-4 h-4 text-gray-400 transition-transform flex-shrink-0",s&&"rotate-180")})]}),(0,w.jsx)(I.N,{children:s&&(0,w.jsx)(o.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,w.jsxs)("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50",children:[(0,w.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:e.content}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[e.url&&(0,w.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-brand-600 hover:text-brand-700 transition-colors",children:["View source",(0,w.jsx)(h.A,{className:"w-3 h-3"})]}),n&&(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:()=>n(e),className:"h-6 px-2 text-xs",children:"View details"}),r&&(0,w.jsxs)(j,{size:"sm",variant:"ghost",onClick:()=>r(e),className:"h-6 px-2 text-xs",children:[(0,w.jsx)(M.A,{className:"w-3 h-3 mr-1"}),"Preview file"]})]})]})})})]}),T=({citations:e,onCitationClick:t,onPreviewClick:s,maxVisible:n=5,className:r})=>{const[i,c]=(0,a.useState)(new Set),[d,g]=(0,a.useState)(!1),u=d?e:e.slice(0,n),m=e.length>n;return 0===e.length?null:(0,w.jsxs)("div",{className:(0,l.cn)("mt-4 space-y-2",r),children:[(0,w.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,w.jsx)(P.A,{className:"w-4 h-4"}),(0,w.jsx)("span",{className:"font-medium",children:"Sources"}),(0,w.jsxs)("span",{className:"text-gray-400",children:["(",e.length,")"]}),m&&(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:()=>g(!d),className:"ml-auto h-6 px-2 text-xs",children:d?"Show less":`Show all ${e.length}`})]}),(0,w.jsx)("div",{className:"space-y-2",children:(0,w.jsx)(I.N,{children:u.map((e,a)=>(0,w.jsx)(o.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,delay:.05*a},children:(0,w.jsx)(R,{citation:e,index:a+1,isExpanded:i.has(e.id),onToggle:()=>(e=>{const t=new Set(i);i.has(e)?t.delete(e):t.add(e),c(t)})(e.id),onClick:t,onPreviewClick:s})},e.id))})}),m&&!d&&(0,w.jsx)("div",{className:"pt-2",children:(0,w.jsxs)(j,{size:"sm",variant:"outline",onClick:()=>g(!0),className:"w-full",children:["Show ",e.length-n," more sources"]})})]})};var O=s(8329),$=s(6509);const F=({details:e,className:t})=>{const[s,n]=(0,a.useState)(!1);if(!e)return null;const i=async e=>{await(0,l.lW)(e)&&r.oR.success("Value copied to clipboard")};return(0,w.jsxs)("div",{className:(0,l.cn)("mt-2",t),children:[(0,w.jsxs)("button",{onClick:()=>n(!s),className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors",children:[(0,w.jsx)(O.A,{className:"w-3 h-3"}),(0,w.jsx)("span",{children:"More Details"}),s?(0,w.jsx)($.A,{className:"w-3 h-3"}):(0,w.jsx)(k.A,{className:"w-3 h-3"})]}),(0,w.jsx)(I.N,{children:s&&(0,w.jsx)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:(0,w.jsxs)("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,w.jsx)("h4",{className:"text-xs font-semibold text-gray-700",children:"Message Details"}),(0,w.jsxs)(j,{size:"sm",variant:"ghost",onClick:async()=>{const t=JSON.stringify(e,null,2);await(0,l.lW)(t)&&r.oR.success("Details copied to clipboard")},className:"h-6 px-2 text-xs",children:[(0,w.jsx)(p.A,{className:"w-3 h-3 mr-1"}),"Copy All"]})]}),(0,w.jsxs)("div",{className:"space-y-2",children:[void 0!==e.user_id&&(0,w.jsx)(D,{label:"User ID",value:String(e.user_id),onCopy:i}),void 0!==e.conversation_id&&(0,w.jsx)(D,{label:"Conversation ID",value:String(e.conversation_id),onCopy:i}),e.updated_at&&(0,w.jsx)(D,{label:"Updated At",value:new Date(e.updated_at).toLocaleString(),onCopy:i}),e.metadata&&(0,w.jsxs)("div",{className:"mt-3 pt-2 border-t border-gray-200",children:[(0,w.jsx)("h5",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Metadata"}),e.metadata.user_ip&&(0,w.jsx)(D,{label:"User IP",value:e.metadata.user_ip,onCopy:i}),e.metadata.user_agent&&(0,w.jsx)(D,{label:"User Agent",value:e.metadata.user_agent,onCopy:i,truncate:!0}),e.metadata.external_id&&(0,w.jsx)(D,{label:"External ID",value:e.metadata.external_id,onCopy:i}),e.metadata.request_source&&(0,w.jsx)(D,{label:"Request Source",value:e.metadata.request_source,onCopy:i})]})]})]})})})]})},D=({label:e,value:t,onCopy:s,truncate:a})=>(0,w.jsxs)("div",{className:"flex items-start justify-between gap-2 text-xs",children:[(0,w.jsxs)("span",{className:"text-gray-600 font-medium whitespace-nowrap",children:[e,":"]}),(0,w.jsxs)("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[(0,w.jsx)("span",{className:(0,l.cn)("text-gray-800 break-all",a&&"truncate"),title:a?t:void 0,children:t}),(0,w.jsx)("button",{onClick:()=>s(t),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0",title:"Copy value",children:(0,w.jsx)(p.A,{className:"w-3 h-3"})})]})]}),L=({language:e,value:t})=>{const[s,n]=(0,a.useState)(!1);return(0,w.jsxs)("div",{className:"relative group",children:[(0,w.jsx)("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:async()=>{await(0,l.lW)(t)&&(n(!0),r.oR.success("Code copied to clipboard"),setTimeout(()=>n(!1),2e3))},className:"h-6 px-2 text-xs bg-foreground text-background hover:bg-foreground/90",children:s?"Copied!":"Copy"})}),(0,w.jsx)(u.A,{language:e,style:m.A,customStyle:{margin:0,borderRadius:"0.5rem",fontSize:"0.875rem"},children:t})]})},U=()=>(0,w.jsx)("span",{className:"inline-block w-0.5 h-4 bg-foreground animate-blink ml-0.5 align-middle"}),q=({content:e,isStreaming:t})=>{const s=e.replace(/<CONTEXT>|<\/CONTEXT>/g,"").trim();return(0,w.jsxs)("div",{className:"prose prose-sm max-w-none text-foreground",children:[(0,w.jsx)(d.oz,{remarkPlugins:[g.A],components:{code({className:e,children:t,...s}){const a=/language-(\w+)/.exec(e||"");return!!a&&a?(0,w.jsx)(L,{language:a[1],value:String(t).replace(/\n$/,""),...s}):(0,w.jsx)("code",{className:"px-1 py-0.5 rounded bg-muted text-sm font-medium",...s,children:t})},a:({href:e,children:t})=>(0,w.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-brand-600 hover:text-brand-700 no-underline hover:underline inline-flex items-center gap-1",children:[t,(0,w.jsx)(h.A,{className:"w-3 h-3"})]})},children:s}),t&&(0,w.jsx)(U,{})]})},z=({message:e,onFeedback:t})=>{const[s,n]=(0,a.useState)(e.feedback||null),i=e=>{n(e),t?.(e),r.oR.success("Thanks for your feedback!")};return(0,w.jsxs)("div",{className:"mt-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:async()=>{await(0,l.lW)(e.content)&&r.oR.success("Message copied to clipboard")},className:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"Copy message",children:(0,w.jsx)(p.A,{className:"h-4 w-4"})}),(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:()=>i("like"),className:(0,l.cn)("h-8 w-8 text-muted-foreground hover:text-foreground","like"===s&&"text-success hover:text-success/90"),title:"Good response",children:(0,w.jsx)(f.A,{className:"h-4 w-4"})}),(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:()=>i("dislike"),className:(0,l.cn)("h-8 w-8 text-muted-foreground hover:text-foreground","dislike"===s&&"text-destructive hover:text-destructive/90"),title:"Bad response",children:(0,w.jsx)(x.A,{className:"h-4 w-4"})}),(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:()=>{r.oR.info("Regenerating response...")},className:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"Regenerate response",children:(0,w.jsx)(v.A,{className:"h-4 w-4"})})]})},K=({message:e,agent:t,isStreaming:s=!1,isLast:a=!1,onCitationClick:n,onPreviewClick:r,onFeedback:i,className:c})=>{const d="user"===e.role;return(0,w.jsx)(o.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:(0,l.cn)("group relative px-4 py-6 transition-colors",d?"bg-background":"bg-muted border-y border-border","hover:bg-opacity-80",c),children:(0,w.jsxs)("div",{className:"max-w-3xl mx-auto flex gap-4",children:[(0,w.jsx)("div",{className:"flex-shrink-0",children:d?(0,w.jsx)(E,{size:"md",className:"bg-secondary"}):(0,w.jsx)(A,{agent:t,size:"md",className:"bg-background border border-border"})}),(0,w.jsxs)("div",{className:"flex-1 overflow-hidden",children:[e.status&&"sent"!==e.status&&(0,w.jsxs)("div",{className:"mb-2 text-xs text-muted-foreground",children:["sending"===e.status&&"Sending...","error"===e.status&&(0,w.jsx)("span",{className:"text-red-500",children:"Failed to send"})]}),d?(0,w.jsx)("p",{className:"text-foreground whitespace-pre-wrap",children:e.content}):(0,w.jsx)(q,{content:e.content,isStreaming:s}),e.citations&&e.citations.length>0&&(0,w.jsx)(T,{citations:e.citations,onCitationClick:n,onPreviewClick:r}),(0,w.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:(0,l.Ey)(e.timestamp)}),(0,w.jsx)(F,{details:e.details}),!d&&!s&&(0,w.jsx)(z,{message:e,onFeedback:i})]})]})})};var G=s(3429),V=s(999),B=s(2020),J=s(5476),Y=s(1016),W=s(7052),H=s(2158);const X=({size:e="md",className:t,label:s="Loading..."})=>(0,w.jsx)(H.A,{className:(0,l.cn)("animate-spin text-primary",{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"}[e],t),"aria-label":s}),Q=({className:e,animate:t=!0})=>(0,w.jsx)("div",{className:(0,l.cn)("bg-muted rounded",t&&"animate-pulse",e)}),Z=({visible:e,message:t,blur:s=!0,className:a})=>e?(0,w.jsx)("div",{className:(0,l.cn)("absolute inset-0 z-50 flex items-center justify-center","bg-background/80 transition-opacity duration-200",s&&"backdrop-blur-sm",a),children:(0,w.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,w.jsx)(X,{size:"lg"}),t&&(0,w.jsx)("p",{className:"text-sm text-muted-foreground",children:t})]})}):null,ee=({isAssistant:e=!1,lines:t=3})=>(0,w.jsxs)("div",{className:(0,l.cn)("flex gap-3 p-4",e?"bg-muted":"bg-background"),children:[(0,w.jsx)(Q,{className:"h-8 w-8 rounded-full flex-shrink-0"}),(0,w.jsx)("div",{className:"flex-1 space-y-2",children:Array.from({length:t}).map((e,s)=>(0,w.jsx)(Q,{className:(0,l.cn)("h-4",s===t-1?"w-3/4":"w-full")},s))})]}),te=({count:e=3})=>(0,w.jsx)("div",{className:"space-y-2 p-2",children:Array.from({length:e}).map((e,t)=>(0,w.jsxs)("div",{className:"p-3 rounded-lg",children:[(0,w.jsx)(Q,{className:"h-4 w-3/4 mb-2"}),(0,w.jsx)(Q,{className:"h-3 w-1/2"})]},t))});var se=s(5063),ae=s(316);const ne=ae.Kq,re=ae.bL,ie=ae.l9,oe=a.forwardRef(({className:e,sideOffset:t=4,...s},a)=>(0,w.jsx)(ae.UC,{ref:a,sideOffset:t,className:(0,l.cn)("z-50 overflow-hidden rounded-md bg-gray-900 px-3 py-1.5 text-xs text-gray-50 animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));function ce({onClick:e,disabled:t}){return(0,w.jsx)(ne,{children:(0,w.jsxs)(re,{children:[(0,w.jsx)(ie,{asChild:!0,children:(0,w.jsxs)("button",{type:"button",onClick:e,disabled:t,className:" relative h-10 w-10 flex-shrink-0 rounded-full bg-gradient-to-br from-purple-500 via-pink-500 to-red-500 hover:from-purple-600 hover:via-pink-600 hover:to-red-600 active:from-purple-700 active:via-pink-700 active:to-red-700 disabled:from-gray-400 disabled:via-gray-500 disabled:to-gray-600 shadow-lg hover:shadow-xl active:shadow-md transition-all duration-200 ease-in-out hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 group flex items-center justify-center border-2 border-white/20 hover:border-white/30 ",children:[(0,w.jsx)("div",{className:" absolute inset-0 rounded-full bg-gradient-to-br from-purple-400/30 via-pink-400/30 to-red-400/30 opacity-0 group-hover:opacity-100 animate-pulse transition-opacity duration-300 blur-sm "}),(0,w.jsx)(se.A,{className:" h-5 w-5 text-white relative z-10 drop-shadow-sm group-hover:drop-shadow-md transition-all duration-200 "})]})}),(0,w.jsx)(oe,{children:(0,w.jsx)("p",{children:"Try voice mode"})})]})})}oe.displayName=ae.UC.displayName;const le=({file:e,onRemove:t})=>{const s=(0,l.I3)(e.type);return(0,w.jsxs)(o.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"flex items-center gap-2 px-3 py-1.5 bg-muted hover:bg-accent rounded-lg transition-colors",children:[(0,w.jsx)("div",{className:"text-muted-foreground",children:s}),(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,w.jsx)("div",{className:"text-sm font-medium text-foreground truncate",children:e.name}),(0,w.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,w.jsx)("span",{children:(0,l.v7)(e.size)}),"uploading"===e.status&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("span",{children:"•"}),(0,w.jsxs)("span",{children:[e.progress,"%"]})]}),"error"===e.status&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("span",{children:"•"}),(0,w.jsxs)("span",{className:"text-destructive flex items-center gap-1",children:[(0,w.jsx)(V.A,{className:"w-3 h-3"}),"Error"]})]})]})]}),"uploading"===e.status&&(0,w.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-muted rounded-b",children:(0,w.jsx)("div",{className:"h-full bg-brand-500 rounded-b transition-all duration-300",style:{width:`${e.progress}%`}})}),(0,w.jsx)("button",{onClick:t,className:"p-0.5 rounded hover:bg-accent-foreground/20 transition-colors",disabled:"uploading"===e.status,children:(0,w.jsx)(B.A,{className:"w-3 h-3 text-muted-foreground"})})]})},de=({onUpload:e,disabled:t})=>{const s=(0,a.useRef)(null);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("input",{ref:s,type:"file",multiple:!0,accept:l.aH.ACCEPTED_FILE_TYPES.join(","),onChange:t=>{const s=Array.from(t.target.files||[]);s.length>0&&(e(s),t.target.value="")},className:"hidden"}),(0,w.jsx)(j,{type:"button",size:"icon",variant:"ghost",onClick:()=>{s.current?.click()},disabled:t,className:"h-10 w-10 text-muted-foreground hover:text-foreground",title:"Upload files",children:(0,w.jsx)(J.A,{className:"h-5 w-5"})})]})},ge=({onSend:e,disabled:t=!1,placeholder:s="Send a message...",maxLength:n=l.aH.MAX_MESSAGE_LENGTH,className:i,onVoiceClick:c})=>{const[d,g]=(0,a.useState)(""),[u,m]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1),f=(0,a.useRef)(null),x=(0,a.useCallback)(()=>{const e=f.current;if(e){e.style.height="auto";const t=e.scrollHeight,s=200;e.style.height=`${Math.min(t,s)}px`}},[]),v=s=>{if(s.preventDefault(),t)return;if(!d.trim()&&0===u.length)return;const a=u.filter(e=>"uploaded"===e.status).map(e=>e.file);e(d.trim(),a),g(""),m([]),f.current&&(f.current.style.height="auto"),setTimeout(()=>{f.current?.focus()},0)},y=(0,a.useCallback)(e=>{const t=e.filter(e=>e.size>l.aH.MAX_FILE_SIZE?(r.oR.error(`File "${e.name}" is too large. Maximum size is ${(0,l.v7)(l.aH.MAX_FILE_SIZE)}`),!1):!!(0,l.B6)(e.type,l.aH.ACCEPTED_FILE_TYPES)||(r.oR.error(`File type "${e.type}" is not supported`),!1)).map(e=>({id:(0,l.$C)(),name:e.name,size:e.size,type:e.type,status:"uploading",progress:0,file:e}));m(e=>[...e,...t]),t.forEach(e=>{b(e)})},[]),b=e=>{let t=0;const s=setInterval(()=>{t+=20*Math.random(),t>=100?(t=100,clearInterval(s),m(t=>t.map(t=>t.id===e.id?{...t,status:"uploaded",progress:100}:t))):m(s=>s.map(s=>s.id===e.id?{...s,progress:Math.round(t)}:s))},100)},{getRootProps:S,getInputProps:N,isDragActive:C}=(0,G.VB)({onDrop:y,noClick:!0,noKeyboard:!0,accept:l.aH.ACCEPTED_FILE_TYPES.reduce((e,t)=>(e[t]=[],e),{}),maxSize:l.aH.MAX_FILE_SIZE,onDragEnter:()=>p(!0),onDragLeave:()=>p(!1)}),_=!t&&(d.trim()||u.some(e=>"uploaded"===e.status));return(0,w.jsxs)("div",{...S(),className:(0,l.cn)("border-t border-border bg-background px-4 py-3 relative",C&&"bg-brand-50",i),children:[(0,w.jsx)("input",{...N()}),(0,w.jsx)(I.N,{children:C&&(0,w.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-brand-50 border-2 border-dashed border-brand-300 rounded-lg flex items-center justify-center z-10",children:(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)(Y.A,{className:"w-8 h-8 text-brand-600 mx-auto mb-2"}),(0,w.jsx)("p",{className:"text-brand-700 font-medium",children:"Drop files here to upload"}),(0,w.jsx)("p",{className:"text-brand-600 text-sm",children:"Supports PDF, DOC, TXT, and more"})]})})}),(0,w.jsx)(I.N,{children:u.length>0&&(0,w.jsx)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-2 flex flex-wrap gap-2",children:u.map(e=>(0,w.jsx)(le,{file:e,onRemove:()=>{return t=e.id,void m(e=>e.filter(e=>e.id!==t));var t}},e.id))})}),(0,w.jsxs)("form",{onSubmit:v,className:"flex items-end gap-2",children:[(0,w.jsx)(de,{onUpload:y,disabled:t}),c&&(0,w.jsx)(ce,{onClick:c,disabled:t}),(0,w.jsxs)("div",{className:"flex-1 relative",children:[(0,w.jsx)("textarea",{ref:f,value:d,onChange:e=>{const t=e.target.value;t.length<=n&&(g(t),x())},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v(e))},placeholder:s,disabled:t,rows:1,className:(0,l.cn)("w-full resize-none rounded-lg border border-input bg-background","px-3 py-2 pr-12","focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent","disabled:opacity-50 disabled:cursor-not-allowed","min-h-[44px] max-h-[200px]","placeholder:text-muted-foreground text-foreground"),style:{height:"auto",overflowY:d.split("\n").length>5?"auto":"hidden"}}),d.length>0&&(0,w.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground pointer-events-none",children:[d.length,"/",n]})]}),(0,w.jsx)(j,{type:"submit",size:"icon",disabled:!_,className:(0,l.cn)("h-10 w-10 flex-shrink-0","transition-all duration-200"),title:t?"Sending message...":"Send message",children:t?(0,w.jsx)(X,{size:"sm",className:"text-white"}):(0,w.jsx)(W.A,{className:"h-5 w-5"})})]}),(0,w.jsx)("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:(0,w.jsx)("span",{children:"Press Enter to send, Shift+Enter for new line"})})]})},ue=({className:e})=>(0,w.jsx)("div",{className:(0,l.cn)("px-4 py-6 bg-muted border-y border-border",e),children:(0,w.jsxs)("div",{className:"max-w-3xl mx-auto flex gap-4",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-full bg-background border border-border flex items-center justify-center flex-shrink-0",children:(0,w.jsx)(c.A,{className:"w-4 h-4 text-brand-600"})}),(0,w.jsxs)("div",{className:"flex items-center gap-1 py-2",children:[(0,w.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce-subtle"}),(0,w.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce-subtle delay-100"}),(0,w.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce-subtle delay-200"})]})]})});var me=s(908),he=s(871),pe=s(5294),fe=s(1216),xe=s(4267);const ve=({agent:e,size:t="md",isSelected:s=!1,className:a})=>{const n={sm:"w-3 h-3",md:"w-4 h-4"},r=e?.settings?.chatbot_avatar;return(0,w.jsx)("div",{className:(0,l.cn)("rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",{sm:"w-6 h-6",md:"w-8 h-8"}[t],s?"bg-brand-600":"bg-gray-200",a),children:r?(0,w.jsx)("img",{src:r,alt:`${e?.project_name} avatar`,className:"w-full h-full object-cover",onError:e=>{const a=e.target;a.style.display="none";const r=a.parentElement;if(r){const e=document.createElement("div");e.className="w-full h-full flex items-center justify-center",e.innerHTML=`<svg class="${n[t]} ${s?"text-white":"text-gray-600"}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>`,r.appendChild(e)}}}):(0,w.jsx)(S.A,{className:(0,l.cn)(n[t],s?"text-white":"text-gray-600")})})},ye=({agent:e,isSelected:t,onSelect:s,onSettingsClick:a})=>(0,w.jsxs)("div",{className:(0,l.cn)("flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors group","hover:bg-gray-50",t&&"bg-brand-50 hover:bg-brand-100"),onClick:()=>s(e),children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,w.jsx)(ve,{agent:e,size:"md",isSelected:t}),(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("h3",{className:"font-medium text-gray-900 truncate",children:e.project_name}),t&&(0,w.jsx)(me.A,{className:"w-4 h-4 text-brand-600 flex-shrink-0"})]}),(0,w.jsx)("div",{className:"mt-1 text-xs text-gray-400",children:(0,w.jsxs)("span",{children:["Status: ",e.is_chat_active?"Active":"Inactive"]})})]})]}),a&&(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:t=>{t.stopPropagation(),a(e)},className:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-gray-400 hover:text-gray-600",title:"Agent Settings",children:(0,w.jsx)(he.A,{className:"h-3 w-3"})})]}),we=({className:e,showSettings:t=!0,onSettingsClick:s})=>{const[n,d]=(0,a.useState)(!1),[g,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(new Set),p=(0,a.useRef)(null),{agents:f,currentAgent:x,loading:v,error:y,fetchAgents:b,loadMoreAgents:S,selectAgent:N,setAgents:C,paginationMeta:_}=(0,i.useAgentStore)();(0,a.useEffect)(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&d(!1)};if(n)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]);const A=async()=>{try{await b(),r.oR.success("Agents refreshed")}catch(e){r.oR.error("Failed to refresh agents")}},E=async e=>{if(!g){u(!0);try{await N(e),d(!1),r.oR.success(`Switched to ${e.project_name}`)}catch(e){r.oR.error("Failed to switch agent")}finally{setTimeout(()=>{u(!1)},300)}}};(0,a.useEffect)(()=>{if(n&&f.length>0){f.some(e=>!e.settings)&&(async e=>{const t=e.filter(e=>!e.settings&&!m.has(e.id));if(0!==t.length){h(e=>{const s=new Set(e);return t.forEach(e=>s.add(e.id)),s});try{const e=(0,xe.KU)(),s=t.map(async t=>{try{const s=await e.getAgentSettings(t.id);return{agentId:t.id,settings:s.data||s}}catch(e){return{agentId:t.id,settings:null}}}),a=await Promise.all(s),n=f.map(e=>{const t=a.find(t=>t.agentId===e.id);return t&&t.settings?{...e,settings:t.settings}:e});C(n)}catch(e){}finally{h(e=>{const s=new Set(e);return t.forEach(e=>s.delete(e.id)),s})}}})(f)}},[n,f.length]);return v&&0===f.length?(0,w.jsx)("div",{className:(0,l.cn)("p-3 bg-background border border-border rounded-lg",e),children:(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-full bg-muted animate-pulse"}),(0,w.jsxs)("div",{className:"flex-1",children:[(0,w.jsx)("div",{className:"h-4 bg-muted rounded animate-pulse mb-2"}),(0,w.jsx)("div",{className:"h-3 bg-muted/50 rounded animate-pulse w-3/4"})]})]})}):y&&0===f.length?(0,w.jsx)("div",{className:(0,l.cn)("p-3 bg-background border border-border rounded-lg",e),children:(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:(0,w.jsx)(V.A,{className:"w-4 h-4 text-red-600"})}),(0,w.jsxs)("div",{className:"flex-1",children:[(0,w.jsx)("p",{className:"text-sm text-red-600 font-medium",children:"Failed to load agents"}),(0,w.jsx)("p",{className:"text-xs text-red-500",children:y})]}),(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:A,className:"text-red-600 hover:text-red-700",children:(0,w.jsx)(pe.A,{className:"w-4 h-4"})})]})}):x||0!==f.length?(0,w.jsxs)("div",{className:(0,l.cn)("relative",e),ref:p,children:[g&&(0,w.jsx)("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm rounded-lg flex items-center justify-center z-50",children:(0,w.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,w.jsx)(X,{size:"sm"}),(0,w.jsx)("span",{className:"text-foreground",children:"Switching agent..."})]})}),(0,w.jsx)("button",{onClick:async()=>{const e=!n;if(d(e),e&&0===f.length)try{await b()}catch(e){}},className:(0,l.cn)("w-full p-3 bg-background border border-border rounded-lg text-left transition-colors","hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",n&&"ring-2 ring-ring border-transparent"),children:(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,w.jsx)(ve,{agent:x,size:"md",isSelected:!0}),(0,w.jsx)("div",{className:"flex-1 min-w-0",children:(0,w.jsx)("h3",{className:"font-medium text-gray-900 truncate",children:x?.project_name||"Select Agent"})})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[x&&(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:e=>{e.stopPropagation(),window.location.href=`/projects?id=${x.id}&tab=analytics`},title:"View Analytics",className:"text-gray-600 hover:text-gray-900",children:(0,w.jsx)(fe.A,{className:"w-4 h-4"})}),(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:e=>{e.stopPropagation(),A()},disabled:v,className:"h-6 w-6 text-gray-400 hover:text-gray-600",title:"Refresh Agents",children:(0,w.jsx)(pe.A,{className:(0,l.cn)("h-3 w-3",v&&"animate-spin")})}),(0,w.jsx)(k.A,{className:(0,l.cn)("w-4 h-4 text-gray-400 transition-transform",n&&"rotate-180")})]})]})}),(0,w.jsx)(I.N,{children:n&&(0,w.jsx)(o.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute top-full left-0 right-0 mt-2 bg-background border border-border rounded-lg shadow-lg z-50 max-h-80 overflow-y-auto",children:(0,w.jsxs)("div",{className:"p-2",children:[(0,w.jsx)("div",{className:"px-2 py-1 mb-2",children:(0,w.jsxs)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:["Available Agents (",Array.isArray(f)?f.length:0,_?.totalCount&&_.totalCount!==f.length&&(0,w.jsxs)("span",{children:[" of ",_.totalCount]}),")"]})}),(0,w.jsx)("div",{className:"space-y-1",children:Array.isArray(f)&&f.length>0?f.map(e=>(0,w.jsx)(ye,{agent:e,isSelected:x?.id===e.id,onSelect:E,onSettingsClick:t?s:void 0},e.id)):(0,w.jsxs)("div",{className:"px-2 py-4 text-center",children:[(0,w.jsx)("p",{className:"text-sm text-gray-500",children:"No agents found"}),(0,w.jsxs)(j,{size:"sm",variant:"ghost",onClick:A,className:"mt-2",children:[(0,w.jsx)(pe.A,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})}),Array.isArray(f)&&f.length>0&&_?.hasMore&&(0,w.jsx)("div",{className:"px-2 py-2 border-t",children:(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:async()=>{try{await S()}catch(e){}},disabled:v,className:"w-full",children:v?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(pe.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading..."]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(k.A,{className:"w-4 h-4 mr-2"}),"Load More Agents"]})})})]})})})]}):(0,w.jsx)("div",{className:(0,l.cn)("p-3 bg-background border border-border rounded-lg",e),children:(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:(0,w.jsx)(c.A,{className:"w-4 h-4 text-gray-600"})}),(0,w.jsxs)("div",{className:"flex-1",children:[(0,w.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"No agents available"}),(0,w.jsx)("p",{className:"text-xs text-gray-500",children:"Check your API configuration"})]}),(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:A,disabled:v,children:(0,w.jsx)(pe.A,{className:(0,l.cn)("w-4 h-4",v&&"animate-spin")})})]})})};var be=s(3373),je=s(6069),Se=s(354),Ne=s(5772),Ce=s(7292);const _e=({isOpen:e,onClose:t,citationId:s,projectId:n})=>{const[r,i]=(0,a.useState)(!1),[c,l]=(0,a.useState)(null),[d,g]=(0,a.useState)(null),[u,m]=(0,a.useState)(!1),{currentAgent:p}=(0,Ce.o)(),f=n||p?.id;(0,a.useEffect)(()=>{e&&f&&s&&x()},[e,f,s]);const x=async()=>{if(f&&s){i(!0),l(null),m(!1);try{const e=(0,xe.KU)(),t=await e.getCitation(f,"string"==typeof s?parseInt(s,10):s);t.data&&(g(t.data),Ne.v.info("CITATION","Citation details fetched",{citationId:s,projectId:f,hasImage:!!t.data.image}))}catch(e){const t=e instanceof Error?e.message:"Failed to fetch citation details";l(t),Ne.v.error("CITATION","Failed to fetch citation details",{error:e,citationId:s,projectId:f})}finally{i(!1)}}else l("Missing project or citation information")};return e?(0,w.jsx)(I.N,{children:(0,w.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,w.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/50"}),(0,w.jsxs)(o.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,w.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Citation Details"}),(0,w.jsx)(j,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8",children:(0,w.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,w.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:r?(0,w.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,w.jsx)(be.A,{className:"h-8 w-8 animate-spin text-gray-400"})}):c?(0,w.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[(0,w.jsx)(V.A,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),(0,w.jsxs)("div",{className:"flex-1",children:[(0,w.jsx)("p",{className:"text-sm font-medium text-red-900",children:"Error loading citation"}),(0,w.jsx)("p",{className:"text-sm text-red-700 mt-1",children:c})]})]}):d?(0,w.jsxs)("div",{className:"space-y-4",children:[d.image&&!u&&(0,w.jsx)("div",{className:"relative rounded-lg overflow-hidden bg-gray-100",children:(0,w.jsx)("img",{src:d.image,alt:d.title,className:"w-full h-auto",onError:()=>m(!0)})}),(0,w.jsx)("div",{children:(0,w.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:d.title})}),(0,w.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,w.jsx)(je.A,{className:"h-4 w-4"}),(0,w.jsx)("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-brand-600 transition-colors truncate",children:d.url})]}),d.description&&(0,w.jsx)("div",{className:"prose prose-gray max-w-none",children:(0,w.jsx)("p",{className:"text-gray-700",children:d.description})}),(0,w.jsxs)("div",{className:"pt-4 border-t space-y-2",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,w.jsx)("span",{className:"text-gray-500",children:"Citation ID"}),(0,w.jsxs)("span",{className:"font-mono text-gray-700",children:["#",d.id]})]}),d.image&&(0,w.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,w.jsx)("span",{className:"text-gray-500",children:"Has preview image"}),(0,w.jsx)(Se.A,{className:"h-4 w-4 text-gray-400"})]})]})]}):null}),(0,w.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("div",{className:"text-xs text-gray-500",children:"Open Graph data from cited source"}),d&&(0,w.jsxs)("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-brand-600 hover:text-brand-700 transition-colors",children:["Visit source",(0,w.jsx)(h.A,{className:"h-3.5 w-3.5"})]})]})})]})]})}):null};var Ae=s(8722);const Ee=({isOpen:e,onClose:t,citationId:s,fileName:n="Citation File"})=>{const[i,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(null),[g,u]=(0,a.useState)(null),[m,h]=(0,a.useState)("text/plain"),[f,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&s&&v()},[e,s]);const v=async()=>{c(!0),d(null);try{const e=(0,xe.KU)(),t=await e.previewCitationFile(s);"string"==typeof t?(u(t),h("text/plain")):t.data?(u(t.data.content||t.data),h(t.data.content_type||"text/plain")):(u(JSON.stringify(t,null,2)),h("application/json")),Ne.v.info("CITATION_PREVIEW","File preview fetched",{citationId:s,contentLength:g?.length})}catch(e){Ne.v.error("CITATION_PREVIEW","Failed to fetch file preview",{error:e,citationId:s}),400===e.status?d("Invalid citation ID."):401===e.status?d("Authentication failed. Please log in again."):403===e.status?d("Access denied. You do not have permission to view this file."):404===e.status?d("Citation file not found."):500===e.status?d("Server error. Please try again later."):d("Failed to load file preview.")}finally{c(!1)}};return e?(0,w.jsx)(I.N,{children:(0,w.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,w.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/50"}),(0,w.jsxs)(o.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)(M.A,{className:"h-5 w-5 text-gray-600"}),(0,w.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:n})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(j,{variant:"outline",size:"sm",onClick:async()=>{if(g)try{await navigator.clipboard.writeText(g),x(!0),r.oR.success("Content copied to clipboard"),setTimeout(()=>x(!1),2e3)}catch(e){r.oR.error("Failed to copy content")}},disabled:!g,children:f?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(me.A,{className:"h-4 w-4 mr-2"}),"Copied"]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Copy"]})}),(0,w.jsxs)(j,{variant:"outline",size:"sm",onClick:()=>{if(!g)return;const e=new Blob([g],{type:m}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),r.oR.success("File downloaded")},disabled:!g,children:[(0,w.jsx)(Ae.A,{className:"h-4 w-4 mr-2"}),"Download"]}),(0,w.jsx)(j,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8",children:(0,w.jsx)(B.A,{className:"h-4 w-4"})})]})]}),(0,w.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:i?(0,w.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,w.jsx)(be.A,{className:"h-8 w-8 animate-spin text-gray-400"})}):l?(0,w.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[(0,w.jsx)(V.A,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),(0,w.jsxs)("div",{className:"flex-1",children:[(0,w.jsx)("p",{className:"text-sm font-medium text-red-900",children:"Error loading file"}),(0,w.jsx)("p",{className:"text-sm text-red-700 mt-1",children:l})]})]}):g?(0,w.jsx)("div",{className:"font-mono text-sm bg-gray-50 rounded-lg p-4",children:(0,w.jsx)("pre",{className:"whitespace-pre-wrap break-words",children:g})}):null}),(0,w.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsxs)("div",{className:"text-xs text-gray-500",children:["Citation ID: ",s]}),(0,w.jsx)("div",{className:"text-xs text-gray-500",children:m})]})})]})]})}):null};var Ie=s(6424),ke=s(5854),Me=s(783),Pe=s(9606);const Re=({sessionId:e,maxConversations:t,currentConversationId:s,onConversationChange:n,onCreateConversation:i,className:c,refreshKey:d})=>{const[g,u]=(0,a.useState)([]),[m,h]=(0,a.useState)(null),[p,f]=(0,a.useState)(""),[x,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const t=()=>{const t=localStorage.getItem(`customgpt_conversations_${e}`);if(t)try{const e=JSON.parse(t);u(e)}catch(e){}};return t(),window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[e,d]);const y=t=>{const s=g.map(e=>e.id===t?{...e,title:p}:e);u(s),localStorage.setItem(`customgpt_conversations_${e}`,JSON.stringify(s)),h(null)},b=g.find(e=>e.id===s);return(0,w.jsxs)("div",{className:(0,l.cn)("relative",c),children:[(0,w.jsxs)("button",{onClick:()=>v(!x),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors w-full",children:[(0,w.jsx)(Ie.A,{className:"w-4 h-4"}),(0,w.jsx)("span",{className:"truncate flex-1 text-left",children:b?.title||"Select Conversation"}),(0,w.jsx)("svg",{className:(0,l.cn)("w-4 h-4 transition-transform",x&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(0,w.jsx)(I.N,{children:x&&(0,w.jsxs)(o.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-80 overflow-y-auto",children:[(0,w.jsxs)("button",{onClick:()=>{t&&g.length>=t?r.oR.error(`You've reached the maximum limit of ${t} conversations. Please delete an existing conversation to create a new one.`):i?.()},disabled:!!t&&g.length>=t,className:"flex items-center gap-2 w-full px-4 py-3 text-sm font-medium text-brand-600 hover:bg-brand-50 disabled:opacity-50 disabled:cursor-not-allowed border-b",children:[(0,w.jsx)(ke.A,{className:"w-4 h-4"}),"New Conversation"]}),(0,w.jsx)("div",{className:"py-2",children:g.map(t=>(0,w.jsx)("div",{className:(0,l.cn)("group flex items-center px-4 py-2 hover:bg-gray-50",s===t.id&&"bg-brand-50"),children:m===t.id?(0,w.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,w.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&y(t.id),"Escape"===e.key&&h(null)},className:"flex-1 px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-brand-500",autoFocus:!0}),(0,w.jsx)("button",{onClick:()=>y(t.id),className:"p-1 text-green-600 hover:bg-green-50 rounded",children:(0,w.jsx)(me.A,{className:"w-4 h-4"})}),(0,w.jsx)("button",{onClick:()=>h(null),className:"p-1 text-gray-400 hover:bg-gray-100 rounded",children:(0,w.jsx)(B.A,{className:"w-4 h-4"})})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("button",{onClick:()=>(e=>{n?.(e),v(!1)})(t),className:"flex-1 text-left",children:[(0,w.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.title}),(0,w.jsx)("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]}),(0,w.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,w.jsx)("button",{onClick:()=>(e=>{h(e.id),f(e.title)})(t),className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",children:(0,w.jsx)(Me.A,{className:"w-3 h-3"})}),(0,w.jsx)("button",{onClick:()=>(t=>{if(g.length<=1)return void r.oR.error("Cannot delete the last conversation");const a=g.filter(e=>e.id!==t);u(a),localStorage.setItem(`customgpt_conversations_${e}`,JSON.stringify(a)),s===t&&a.length>0&&n?.(a[0])})(t.id),className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",children:(0,w.jsx)(Pe.A,{className:"w-3 h-3"})})]})]})},t.id))})]})})]})};var Te=s(7724),Oe=s(3458),$e=s(5734),Fe=s(6455),De=s(6369);const Le=({error:e,statusCode:t,onRetry:s,className:a})=>{const{statusCode:n,message:r}=(e=>{if("string"==typeof e){const t=e.match(/(\d{3})/);return{statusCode:t?parseInt(t[1]):void 0,message:e}}return{statusCode:e.status||e.statusCode,message:e.message}})(e),i=t||n,o=((e,t)=>{switch(e){case 400:return{icon:V.A,title:"Invalid Request",description:"The request format is invalid. Please check your input and try again.",className:"border-orange-200 bg-orange-50",iconClassName:"text-orange-600",textClassName:"text-orange-800"};case 401:return{icon:Te.A,title:"Authentication Failed",description:"Your API key is either missing or invalid. Please check your API key configuration.",className:"border-red-200 bg-red-50",iconClassName:"text-red-600",textClassName:"text-red-800",showSupport:!0};case 403:return t&&(t.toLowerCase().includes("inactive")||t.toLowerCase().includes("no documents")||t.toLowerCase().includes("agent is not active")||t.toLowerCase().includes("project is not active")||t.toLowerCase().includes("no documents uploaded"))?{icon:V.A,title:"Agent Inactive",description:"This agent is inactive. Please add documents to activate it before starting a conversation.",className:"border-orange-200 bg-orange-50",iconClassName:"text-orange-600",textClassName:"text-orange-800"}:{icon:Te.A,title:"Access Denied",description:"You don't have permission to access this resource. Please check your API key permissions.",className:"border-red-200 bg-red-50",iconClassName:"text-red-600",textClassName:"text-red-800",showSupport:!0};case 404:return{icon:Oe.A,title:"Not Found",description:"The requested agent or conversation was not found. It may have been deleted or you may not have access.",className:"border-gray-200 bg-gray-50",iconClassName:"text-gray-600",textClassName:"text-gray-800"};case 429:return{icon:$e.A,title:"Query Credits Exhausted",description:"You have exhausted your current query credits. Please contact customer service for assistance.",className:"border-yellow-200 bg-yellow-50",iconClassName:"text-yellow-600",textClassName:"text-yellow-800",showSupport:!0,supportUrl:"https://customgpt.freshdesk.com/support/home"};case 500:case 502:case 503:case 504:return{icon:Fe.A,title:"Server Error",description:"An internal server error occurred. Please try again later or contact support if the issue persists.",className:"border-red-200 bg-red-50",iconClassName:"text-red-600",textClassName:"text-red-800",showRetry:!0};default:return{icon:De.A,title:"Error",description:t||"An unexpected error occurred. Please try again.",className:"border-red-200 bg-red-50",iconClassName:"text-red-600",textClassName:"text-red-800",showRetry:!0}}})(i,r),c=o.icon;return(0,w.jsx)("div",{className:(0,l.cn)("p-4 rounded-lg border",o.className,a),children:(0,w.jsxs)("div",{className:"flex items-start gap-3",children:[(0,w.jsx)(c,{className:(0,l.cn)("w-5 h-5 mt-0.5 flex-shrink-0",o.iconClassName)}),(0,w.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("h3",{className:(0,l.cn)("font-medium",o.textClassName),children:[o.title,i&&` (${i})`]}),(0,w.jsx)("p",{className:(0,l.cn)("text-sm mt-1",o.textClassName,"opacity-90"),children:o.description})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[o.showRetry&&s&&(0,w.jsx)(j,{size:"sm",variant:"outline",onClick:s,className:"text-xs",children:"Try Again"}),o.showSupport&&(0,w.jsx)("a",{href:o.supportUrl||"https://customgpt.freshdesk.com/support/home",target:"_blank",rel:"noopener noreferrer",className:"text-xs underline hover:no-underline",children:"Contact Support"})]}),r&&r!==o.description&&(0,w.jsxs)("details",{className:"mt-3",children:[(0,w.jsx)("summary",{className:(0,l.cn)("text-xs cursor-pointer",o.textClassName,"opacity-70"),children:"Technical Details"}),(0,w.jsx)("pre",{className:(0,l.cn)("mt-2 p-2 text-xs rounded bg-white bg-opacity-50 overflow-x-auto",o.textClassName,"opacity-80"),children:r})]})]})]})})},Ue=(0,a.createContext)(void 0),qe=({widgetInstance:e,children:t})=>(0,w.jsx)(Ue.Provider,{value:e,children:t});var ze=s(1446),Ke=s(3345);function Ge(e,t,s){const a=`customgpt-messages-cache-${e}`;function n(e,t){try{const s=localStorage.getItem(a),n=s?JSON.parse(s):{};n[e]=t,localStorage.setItem(a,JSON.stringify(n))}catch(e){}}return(0,ze.vt)((r,i)=>({messages:new Map,streamingMessage:null,isStreaming:!1,loading:!1,error:null,sendMessage:async(a,n)=>{const o="undefined"!=typeof window&&window.__customgpt_demo_mode;if(!t||!s)throw Ne.v.error("MESSAGES","Store references not provided"),new Error("Store references not provided");const c=t.getState().currentAgent;if(!c)throw Ne.v.error("MESSAGES","No agent selected"),new Error("No agent selected");Ne.v.info("MESSAGES","Sending message from widget store",{sessionId:e,agentId:c.id,agentName:c.project_name,messageLength:a.length,hasFiles:n&&n.length>0});const d=await s.getState().ensureConversation("string"==typeof c.id?parseInt(c.id):c.id,a);if(Ne.v.info("MESSAGES","Conversation ensured",{conversationId:d.id,sessionId:d.session_id,hasSessionId:!!d.session_id,isNew:!d.message_count||0===d.message_count}),!d.session_id)throw Ne.v.error("MESSAGES","Conversation missing session_id",{conversation:d}),new Error("Conversation missing session_id");r({loading:!0,error:null});const g=d.id.toString(),u={id:(0,l.$C)(),role:"user",content:a,timestamp:(new Date).toISOString(),status:"sending"};i().addMessage(g,u);const m={id:(0,l.$C)(),role:"assistant",content:"",timestamp:(new Date).toISOString(),citations:[]};r({streamingMessage:m,isStreaming:!0,loading:!1});try{if(n&&n.length>0){const e=(0,xe.KU)();await Promise.all(n.map(t=>e.uploadFile(c.id,t)))}u.status="sent",i().addMessage(g,u);const e=(0,xe.KU)();if(Ne.v.info("MESSAGES","Starting message stream",{agentId:c.id,sessionId:d.session_id,messageContent:a.substring(0,50)}),o){await new Promise(e=>setTimeout(e,1e3));const e=`This is a demo response to: "${a}"`;i().updateStreamingMessage(e),await new Promise(e=>setTimeout(e,500));const t=i().streamingMessage;return t&&(t.status="sent",i().addMessage(g,t)),void r({streamingMessage:null,isStreaming:!1})}try{await e.sendMessageStream(c.id,d.session_id,{prompt:a},e=>{if(Ne.v.info("MESSAGES","Received stream chunk",{type:e.type,hasContent:!!e.content,contentLength:e.content?.length,contentPreview:e.content?.substring(0,50)}),"content"===e.type&&e.content)i().updateStreamingMessage(e.content,e.citations);else if("citation"===e.type&&e.citations){const t=i().streamingMessage;t&&r({streamingMessage:{...t,citations:e.citations}})}},async t=>{Ne.v.error("MESSAGES","Streaming failed, attempting fallback to non-streaming",t);try{const t=await e.sendMessage(c.id,d.session_id,{prompt:a,stream:!1}),s=i().streamingMessage;if(s&&t){let e;e=t.data?t.data:t,s.content=e?.openai_response||e?.content||"No response received",s.citations=e?.citations||[],s.status="sent",i().addMessage(g,s)}r({streamingMessage:null,isStreaming:!1})}catch(e){throw Ne.v.error("MESSAGES","Both streaming and non-streaming failed",e),e}},()=>{const e=i().streamingMessage;e&&(e.status="sent",i().addMessage(g,e)),r({streamingMessage:null,isStreaming:!1}),s.getState().updateConversation(d.id,d.session_id,{name:d.name})})}catch(e){throw Ne.v.error("MESSAGES","Failed to send message",e),r({streamingMessage:null,isStreaming:!1,error:e instanceof Error?e.message:"Failed to send message"}),e}}catch(e){throw Ne.v.error("MESSAGES","Error in sendMessage",e),r({error:e instanceof Error?e.message:"Failed to send message",streamingMessage:null,isStreaming:!1,loading:!1}),e}},loadMessages:async e=>{r({loading:!0,error:null});try{const t=function(e){try{const t=localStorage.getItem(a);return t&&JSON.parse(t)[e]||null}catch(e){return null}}(e);if(t)return void r(s=>({messages:new Map(s.messages).set(e,t),loading:!1}));r(t=>({messages:new Map(t.messages).set(e,[]),loading:!1}))}catch(e){Ne.v.error("MESSAGES","Failed to load messages",e),r({error:e instanceof Error?e.message:"Failed to load messages",loading:!1})}},addMessage:(e,t)=>{r(s=>{const a=new Map(s.messages),r=a.get(e)||[],i=r.findIndex(e=>e.id===t.id);return i>=0?r[i]=t:r.push(t),a.set(e,r),n(e,r),{messages:a}})},updateStreamingMessage:(e,t)=>{r(s=>s.streamingMessage?{streamingMessage:{...s.streamingMessage,content:s.streamingMessage.content+e,citations:t||s.streamingMessage.citations}}:s)},clearMessages:e=>{if(e){r(t=>{const s=new Map(t.messages);return s.delete(e),{messages:s}});try{const t=localStorage.getItem(a);if(t){const s=JSON.parse(t);delete s[e],localStorage.setItem(a,JSON.stringify(s))}}catch(e){}}else{r({messages:new Map});try{localStorage.removeItem(a)}catch(e){}}},cancelStreaming:()=>{Ke.Hr.cancelAllStreams(),r({isStreaming:!1,streamingMessage:null})},getMessagesForConversation:e=>i().messages.get(e)||[],updateMessageFeedback:(e,t)=>{r(s=>{const a=new Map(s.messages);for(const[s,r]of a){const i=r.findIndex(t=>t.id===e);if(-1!==i){const e=[...r];e[i]={...e[i],feedback:t},a.set(s,e),n(s,e);break}}return{messages:a}})},reset:()=>{r({messages:new Map,streamingMessage:null,isStreaming:!1,loading:!1,error:null})}}))}function Ve(e){const t=`customgpt-conversations-cache-${e}`,s=`customgpt-conversation-activity-${e}`;function a(e,s){try{const a=localStorage.getItem(t),n=a?JSON.parse(a):{};n[e]=s,localStorage.setItem(t,JSON.stringify(n))}catch(e){}}function n(e){try{const s=localStorage.getItem(t);if(!s)return null;return JSON.parse(s)[e]||null}catch(e){return null}}function r(){try{const e=localStorage.getItem(s);return e?JSON.parse(e):{}}catch(e){return{}}}return(0,ze.vt)((t,i)=>({conversations:[],currentConversation:null,loading:!1,error:null,lastConversationActivity:r(),currentPage:1,totalPages:1,totalConversations:0,perPage:20,sortOrder:"desc",sortBy:"id",userFilter:"all",fetchConversations:async(s,r)=>{const o="undefined"!=typeof window&&window.__customgpt_demo_mode;Ne.v.info("CONVERSATIONS","Fetching conversations for widget",{sessionId:e,projectId:s,isDemoMode:o}),t({loading:!0,error:null});try{if(o)return i().loadConversations(s.toString());const n=`widget_conversations_${e}`,c=JSON.parse(localStorage.getItem(n)||"[]");if(0===c.length)return void t({conversations:[],loading:!1});const l=(0,xe.KU)(),d={page:r?.page??i().currentPage,per_page:r?.per_page??i().perPage,order:r?.order??i().sortOrder,orderBy:r?.orderBy??i().sortBy,userFilter:r?.userFilter??i().userFilter},g=await l.getConversations(s,d);let u=[],m=null;g&&"object"==typeof g&&(g.data&&g.data.data?(u=g.data.data,m=g.data):Array.isArray(g.data)?u=g.data:Array.isArray(g)&&(u=g));const h=u.filter(e=>c.includes(e.id));Ne.v.info("CONVERSATIONS","Filtered widget conversations",{totalFromAPI:u.length,widgetSpecific:h.length,widgetConvIds:c,paginationData:m}),t({conversations:h,loading:!1,currentPage:m?.current_page??1,totalPages:m?.last_page??1,totalConversations:c.length,...r?.order&&{sortOrder:r.order},...r?.orderBy&&{sortBy:r.orderBy},...r?.userFilter&&{userFilter:r.userFilter}}),a(s.toString(),h)}catch(e){Ne.v.error("CONVERSATIONS","Failed to fetch conversations",e);const a=n(s.toString());t({conversations:a||[],error:e instanceof Error?e.message:"Failed to fetch conversations",loading:!1})}},loadConversations:async s=>{const a="undefined"!=typeof window&&window.__customgpt_demo_mode;Ne.v.info("CONVERSATIONS","Loading conversations for widget store",{sessionId:e,agentId:s,isDemoMode:a}),t({loading:!0,error:null});try{const a=n(s);if(a){const s=a.filter(t=>t.session_id&&t.session_id.includes(e));t({conversations:s,loading:!1}),Ne.v.info("CONVERSATIONS","Loaded session-specific conversations",{totalCached:a.length,sessionSpecific:s.length,sessionId:e})}else t({conversations:[],loading:!1})}catch(e){Ne.v.error("CONVERSATIONS","Failed to load conversations",e),t({error:e instanceof Error?e.message:"Failed to load conversations",loading:!1,conversations:[]})}},createConversation:async(s,n)=>{const r="undefined"!=typeof window&&window.__customgpt_demo_mode;Ne.v.info("CONVERSATIONS","Creating conversation in widget store",{sessionId:e,projectId:s,name:n}),t({loading:!0,error:null});try{const o=(0,xe.KU)();if(r){const r=Date.now(),o=`demo_session_${r}_${Math.floor(1e6*Math.random())}_${e}`,c={id:Math.floor(1e6*Math.random()),session_id:o,project_id:s,name:n||"New Conversation",message_count:0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),deleted_at:null};return t(e=>({conversations:[...e.conversations,c],currentConversation:c,loading:!1})),void a(s.toString(),[...i().conversations])}const c=(await o.createConversation(s,n?{name:n}:void 0)).data,l=`widget_conversations_${e}`,d=JSON.parse(localStorage.getItem(l)||"[]");d.push(c.id),localStorage.setItem(l,JSON.stringify(d)),Ne.v.info("CONVERSATIONS","Created conversation via API",{conversationId:c.id,sessionId:c.session_id,projectId:c.project_id,widgetSessionId:e}),t(e=>({conversations:[...e.conversations,c],currentConversation:c,loading:!1})),a(s.toString(),i().conversations)}catch(e){throw Ne.v.error("CONVERSATIONS","Failed to create conversation",e),t({error:e instanceof Error?e.message:"Failed to create conversation",loading:!1}),e}},updateConversation:async(e,s,n)=>{Ne.v.info("CONVERSATIONS","Updating conversation in widget store",{sessionId:s,conversationId:e,data:n}),t(t=>({conversations:t.conversations.map(t=>t.id.toString()===e.toString()?{...t,name:n.name,updated_at:(new Date).toISOString()}:t)}));const r=i().currentConversation;r&&r.id.toString()===e.toString()&&t({currentConversation:{...r,name:n.name,updated_at:(new Date).toISOString()}});const o=i().conversations.find(t=>t.id.toString()===e.toString())?.project_id;o&&a(o.toString(),i().conversations)},deleteConversation:async s=>{Ne.v.info("CONVERSATIONS","Deleting conversation from widget store",{sessionId:e,conversationId:s});const n=i().conversations.find(e=>e.id.toString()===s);n&&(t(e=>({conversations:e.conversations.filter(e=>e.id.toString()!==s),currentConversation:e.currentConversation?.id.toString()===s?null:e.currentConversation})),a(n.project_id.toString(),i().conversations))},selectConversation:a=>{if(Ne.v.info("CONVERSATIONS","Selecting conversation in widget store",{sessionId:e,conversationId:a?.id}),t({currentConversation:a}),a){const e={...i().lastConversationActivity};e[a.project_id.toString()]=a.id.toString(),t({lastConversationActivity:e}),function(e){try{localStorage.setItem(s,JSON.stringify(e))}catch(e){}}(e)}},ensureConversation:async(e,s)=>{const{currentConversation:a}=i();if(a&&a.project_id===e)return a;const n=s?s.substring(0,50)+(s.length>50?"...":""):"New Conversation";await i().createConversation(e,n);const r=i().conversations[i().conversations.length-1];return t({currentConversation:r}),r},reset:()=>{t({conversations:[],currentConversation:null,loading:!1,error:null,lastConversationActivity:{}})}}))}function Be(e){const t=`customgpt-agents-cache-${e}`,s=`customgpt-selected-agent-${e}`;function a(e){try{localStorage.setItem(t,JSON.stringify(e))}catch(e){}}function n(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}return(0,ze.vt)((r,i)=>({agents:[],currentAgent:null,loading:!1,error:null,fetchAgents:async()=>i().loadAgents(),loadAgents:async()=>{const i="undefined"!=typeof window&&window.__customgpt_demo_mode,o=`__customgpt_widget_${e}`,c="undefined"!=typeof window?window[o]:null;Ne.v.info("AGENTS","Loading agents for widget store",{sessionId:e,isDemoMode:i,hasWidget:!!c,configuredAgentId:c?.config?.agentId}),r({loading:!0,error:null});try{if(c?.config?.agentId){const e=(0,xe.KU)();if(i){const e={id:c.config.agentId,project_name:c.config.name||"CustomGPT Assistant",type:"WIDGET",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_chat_active:!0,is_shared:!1,user_id:0,team_id:0};return r({agents:[e],currentAgent:e,loading:!1}),a([e]),void n(e.id.toString())}try{const t=await e.getAgent(c.config.agentId),s=t.data||t;return Ne.v.info("AGENTS","Fetched specific agent from API",{agentId:s.id,agentName:s.project_name}),r({agents:[s],currentAgent:s,loading:!1}),a([s]),void n(s.id.toString())}catch(e){Ne.v.error("AGENTS","Failed to fetch specific agent",e);const s=function(){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return null}}();if(s&&s.length>0){const e=s.find(e=>e.id===c.config.agentId)||s[0];return void r({agents:s,currentAgent:e,loading:!1})}throw e}}if(!i){const e=(0,xe.KU)(),t=await e.getAgents({page:1,per_page:100});let i=[];t&&"object"==typeof t&&("data"in t&&"total"in t||Array.isArray(t.data)?i=t.data:Array.isArray(t)&&(i=t)),Ne.v.info("AGENTS","Fetched agents from API (first page)",{count:i.length,total:t?.total||i.length});const o=function(){try{return localStorage.getItem(s)}catch(e){return null}}(),c=o&&i.find(e=>e.id.toString()===o)||i[0];return r({agents:i,currentAgent:c||null,loading:!1}),a(i),void(c&&n(c.id.toString()))}if(i){const e=[{id:1,project_name:"Demo Assistant",type:"DEMO",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_chat_active:!0,is_shared:!1,user_id:0,team_id:0}];return r({agents:e,currentAgent:e[0],loading:!1}),a(e),void n(e[0].id.toString())}r({agents:[],currentAgent:null,loading:!1})}catch(e){Ne.v.error("AGENTS","Failed to load agents",e),r({error:e instanceof Error?e.message:"Failed to load agents",loading:!1})}},selectAgent:t=>{Ne.v.info("AGENTS","Selecting agent in widget store",{sessionId:e,agentId:t?.id,agentName:t?.project_name}),r({currentAgent:t}),n(t?.id.toString()||null);const s=`__customgpt_widget_${e}`,a="undefined"!=typeof window?window[s]:null;a&&t&&(a.config.agentId=t.id,a.config.name=t.project_name)},setAgents:e=>{r({agents:e}),a(e)},updateAgent:async(t,s)=>{Ne.v.info("AGENTS","Updating agent in widget store",{sessionId:e,agentId:t,data:s});const n=i().agents.find(e=>e.id===t);if(!n)throw new Error("Agent not found");const o={...n,...s};return r(e=>({agents:e.agents.map(e=>e.id===t?o:e),currentAgent:e.currentAgent?.id===t?o:e.currentAgent})),a(i().agents),o},deleteAgent:async t=>{Ne.v.info("AGENTS","Deleting agent from widget store",{sessionId:e,agentId:t}),r(e=>({agents:e.agents.filter(e=>e.id!==t),currentAgent:e.currentAgent?.id===t?null:e.currentAgent})),a(i().agents)},createAgent:async e=>{throw new Error("Creating agents is not supported in widget mode")},replicateAgent:async e=>{throw new Error("Replicating agents is not supported in widget mode")},getAgentStats:async e=>({messages_sent:0,users_interacted:0,last_message_at:null}),reset:()=>{r({agents:[],currentAgent:null,loading:!1,error:null});try{localStorage.removeItem(t),localStorage.removeItem(s)}catch(e){}}}))}const Je=(0,a.createContext)(null),Ye=({children:e,sessionId:t})=>{const s=(0,a.useRef)(null);if(!s.current){const e=Be(t),a=Ve(t),n=Ge(t,e,a);s.current={messageStore:n,conversationStore:a,agentStore:e}}return(0,w.jsx)(Je.Provider,{value:{stores:s.current},children:e})};function We(){try{return null!==(0,a.useContext)(Je)}catch{return!1}}function He(){const e=(0,a.useContext)(Je);return e?.stores}function Xe(){const e=We(),t=He();return e&&t?(0,ze.Pj)(t.messageStore):(0,i.useMessageStore)()}function Qe(){const e=We(),t=He();return e&&t?(0,ze.Pj)(t.conversationStore):(0,i.useConversationStore)()}function Ze(){const e=We(),t=He();return e&&t?(0,ze.Pj)(t.agentStore):(0,i.useAgentStore)()}var et=s(2690),tt=s(9360),st=s.n(tt);const at=(0,a.forwardRef)(({draw:e},t)=>{const s=(0,a.useRef)(null),n=t||s;return(0,a.useEffect)(()=>{const t=n.current;if(!t)return;const s=t.getContext("2d");if(!s)return;const a=()=>{t.width=window.innerWidth,t.height=window.innerHeight};a(),window.addEventListener("resize",a);const r=t.width,i=t.height,o=r/2,c=i/2;let l;const d=()=>{e(s,r,i,o,c),l=window.requestAnimationFrame(d)};return d(),()=>{window.cancelAnimationFrame(l),window.removeEventListener("resize",a)}},[e]),(0,w.jsx)("canvas",{ref:n,className:"absolute inset-0 w-full h-full",style:{background:"#000000"}})});at.displayName="Canvas";const nt=at;function rt(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const it=new class{constructor(){rt(this,"source",null),rt(this,"sourceIsStarted",!1),rt(this,"conversationThusFar",[]),rt(this,"callbacks",{}),rt(this,"projectId",null),rt(this,"onSpeechStart",()=>{this.debug("Speech started - user is speaking"),this.callbacks.onUserSpeaking?.(),this.stopSourceIfNeeded()}),rt(this,"onSpeechEnd",async e=>{this.debug("Speech ended",{audioLength:e.length,audioDuration:e.length/16e3+"s"}),await this.processAudio(e)}),rt(this,"onMisfire",()=>{this.debug("VAD misfire - noise detected but not speech"),this.callbacks.onReset?.()}),rt(this,"stopSourceIfNeeded",()=>{this.source&&this.sourceIsStarted&&(this.debug("Stopping current audio playback"),this.source.stop(0),this.sourceIsStarted=!1)}),rt(this,"processAudio",async e=>{this.debug("Processing audio started"),this.callbacks.onProcessing?.();try{const t=this.createAudioBlob(e);await this.validate(t),await this.sendData(t)}catch(e){this.error("Error processing audio",e),this.callbacks.onReset?.()}}),rt(this,"createAudioBlob",e=>{const t=et.utils.encodeWAV(e),s=new Blob([t],{type:"audio/wav"});return this.debug("Created audio blob",{size:`${(s.size/1024).toFixed(2)}KB`,type:s.type}),s}),rt(this,"sendData",async e=>{if(this.debug("Preparing to send audio data to server"),!this.projectId)return this.error("No project ID set - cannot send audio"),void this.callbacks.onReset?.();const t=new FormData;t.append("audio",e,"audio.wav"),t.append("projectId",this.projectId),this.debug("Sending request to voice API",{projectId:this.projectId,conversationLength:this.conversationThusFar.length,audioSize:`${(e.size/1024).toFixed(2)}KB`});try{const e=await fetch("/api/proxy/voice/inference",{method:"POST",body:t,headers:{conversation:this.base64Encode(JSON.stringify(this.conversationThusFar))}});if(this.debug("Response received",{status:e.status,ok:e.ok,headers:Object.fromEntries(e.headers.entries())}),!e.ok){const t=await e.text();throw new Error(`API Error (${e.status}): ${t}`)}const s=e.headers.get("text");if(!s)throw new Error("No text header in response");const a=JSON.parse(this.base64Decode(s));if(this.debug("Messages decoded",{newMessages:a}),a.length>0){if("user"===a[0].role){const e=a[0].content;this.callbacks.onDebug?.(`You said: "${e}"`,a[0]),this.callbacks.onTranscriptReceived?.(e)}if(a.length>1&&"assistant"===a[1].role){const e=a[1].content;this.callbacks.onResponseReceived?.(e)}else if(1===a.length&&"assistant"===a[0].role){const e=a[0].content;this.callbacks.onResponseReceived?.(e)}}this.conversationThusFar.push(...a);const n=await e.blob();this.debug("Audio blob received",{size:`${(n.size/1024).toFixed(2)}KB`,type:n.type}),await this.handleSuccess(n)}catch(e){this.error("Failed to send audio data",e),this.handleError(e)}}),rt(this,"handleSuccess",async e=>{this.debug("Playing AI response audio");try{const t=new(window.AudioContext||window.webkitAudioContext);this.stopSourceIfNeeded();const s=await e.arrayBuffer(),a=await t.decodeAudioData(s);this.debug("Audio decoded",{duration:`${a.duration.toFixed(2)}s`,sampleRate:a.sampleRate,numberOfChannels:a.numberOfChannels}),this.source=t.createBufferSource(),this.source.buffer=a,this.source.connect(t.destination),this.source.start(0),this.sourceIsStarted=!0,this.source.onended=()=>{this.debug("Audio playback ended"),this.callbacks.onReset?.()},this.callbacks.onAiSpeaking?.()}catch(e){this.error("Failed to play audio",e),this.callbacks.onReset?.()}}),rt(this,"handleError",e=>{this.error(`Error encountered: ${e.message}`,e),this.callbacks.onReset?.()}),rt(this,"validate",async e=>{this.debug("Validating audio duration");try{const t=new Blob([e],{type:e.type}),s=await t.arrayBuffer(),a=new AudioContext,n=(await a.decodeAudioData(s)).duration,r=.4;if(this.debug("Audio validation",{duration:`${n.toFixed(2)}s`,minDuration:`${r}s`,valid:n>=r}),n<r)throw new Error(`Duration is ${n}s, which is less than minimum of ${r}s`)}catch(e){throw this.error("Audio validation failed",e),e}})}setCallbacks(e){this.callbacks=e,this.debug("Callbacks set",{hasCallbacks:Object.keys(e)})}setProjectId(e){this.projectId=e,this.debug("Project ID set",{projectId:e})}debug(e,t){(new Date).toISOString();this.callbacks.onDebug?.(e,t)}error(e,t){(new Date).toISOString();this.callbacks.onError?.(e)}base64Encode(e){const t=(new TextEncoder).encode(e);return window.btoa(String.fromCharCode(...new Uint8Array(t)))}base64Decode(e){const t=window.atob(e),s=new Uint8Array([...t].map(e=>e.charCodeAt(0)));return(new TextDecoder).decode(s)}clearConversation(){this.conversationThusFar=[]}getConversationThusFar(){return this.conversationThusFar}},ot=280;let ct,lt,dt,gt=5e3;const ut=()=>{ct=52,lt=235,dt=222};ut();let mt=0;const ht={first:void 0},pt={first:void 0};let ft;let xt=1;const vt=-283,yt=()=>"rgba("+ct+","+lt+","+dt+",";let wt,bt,jt,St,Nt,Ct,_t,At,Et,It,kt,Mt,Pt,Rt;function Tt(e,t,s,a,n,r){let i;return null!=pt.first?(i=pt.first,null!=i.next?(pt.first=i.next,i.next.prev=null):pt.first=null):i={},null==ht.first?(ht.first=i,i.prev=null,i.next=null):(i.next=ht.first,ht.first.prev=i,ht.first=i,i.prev=null),i.x=e,i.y=t,i.z=s,i.velX=a,i.velY=n,i.velZ=r,i.age=0,i.dead=!1,i.right=Math.random()<.5,i}function Ot(e){ht.first===e?null!=e.next?(e.next.prev=null,ht.first=e.next):ht.first=null:null==e.next?e.prev.next=null:(e.prev.next=e.next,e.next.prev=e.prev),null==pt.first?(pt.first=e,e.prev=null,e.next=null):(e.next=pt.first,pt.first.prev=e,pt.first=e,e.prev=null)}const $t={onUserSpeaking:()=>{gt=5e3,ct=255,lt=191,dt=0},onProcessing:()=>{gt=1e3,ct=235,lt=67,dt=250},onAiSpeaking:()=>{gt=5e3,ct=201,lt=10,dt=144},reset:()=>{gt=5e3,ut()},draw:function(e,t,s,a,n){if(mt++,mt>=1)for(mt=0,Et=0;Et<8;Et++){It=2*Math.random()*Math.PI,kt=Math.acos(2*Math.random()-1),Mt=ot*Math.sin(kt)*Math.cos(It),Pt=ot*Math.sin(kt)*Math.sin(It),Rt=ot*Math.cos(kt);const e=Tt(Mt,0+Pt,vt+Rt,.002*Mt,.002*Pt,.002*Rt);e.attack=50,e.hold=50,e.decay=100,e.initValue=0,e.holdValue=1,e.lastValue=0,e.stuckTime=90+20*Math.random(),e.accelX=0,e.accelY=-0,e.accelZ=0}for(xt=(xt+2*Math.PI/gt)%(2*Math.PI),St=Math.sin(xt),Nt=Math.cos(xt),e.fillStyle="#000000",e.fillRect(0,0,t,s),wt=ht.first;null!=wt;)jt=wt.next,wt.age++,wt.age>wt.stuckTime&&(wt.velX+=wt.accelX+.1*(2*Math.random()-1),wt.velY+=wt.accelY+.1*(2*Math.random()-1),wt.velZ+=wt.accelZ+.1*(2*Math.random()-1),wt.x+=wt.velX,wt.y+=wt.velY,wt.z+=wt.velZ),Ct=Nt*wt.x+St*(wt.z-vt),_t=-St*wt.x+Nt*(wt.z-vt)+vt,ft=320/(320-_t),wt.projX=Ct*ft+a,wt.projY=wt.y*ft+n,wt.age<wt.attack+wt.hold+wt.decay?wt.age<wt.attack?wt.alpha=(wt.holdValue-wt.initValue)/wt.attack*wt.age+wt.initValue:wt.age<wt.attack+wt.hold?wt.alpha=wt.holdValue:wt.age<wt.attack+wt.hold+wt.decay&&(wt.alpha=(wt.lastValue-wt.holdValue)/wt.decay*(wt.age-wt.attack-wt.hold)+wt.holdValue):wt.dead=!0,bt=wt.projX>t||wt.projX<0||wt.projY<0||wt.projY>s||_t>318,bt||wt.dead?Ot(wt):(At=1-_t/-750,At=At>1?1:At<0?0:At,e.fillStyle=yt()+At*wt.alpha+")",e.beginPath(),e.arc(wt.projX,wt.projY,2.5*ft,0,2*Math.PI,!1),e.closePath(),e.fill()),wt=jt},init:()=>{}};function Ft({isOpen:e,onClose:t,projectId:s,projectName:n}){const[r,i]=(0,a.useState)(!0),[o,c]=(0,a.useState)(""),[d,g]=(0,a.useState)([]),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),{addMessage:f}=((0,a.useRef)(null),Xe()),{currentConversation:x,ensureConversation:v}=Qe(),[y,b]=(0,a.useState)(null),j=(0,et.useMicVAD)({preSpeechPadFrames:5,positiveSpeechThreshold:.9,negativeSpeechThreshold:.75,minSpeechFrames:4,startOnLoad:!1,workletURL:"/vad.worklet.bundle.min.js",modelURL:"/silero_vad.onnx",onSpeechStart:()=>{const e=`${(new Date).toLocaleTimeString()} - VAD: Speech started`;g(t=>[...t.slice(-10),e]),it.onSpeechStart()},onSpeechEnd:e=>{const t=`${(new Date).toLocaleTimeString()} - VAD: Speech ended, audio length: ${e.length}`;g(e=>[...e.slice(-10),t]),it.onSpeechEnd(e)},onVADMisfire:()=>{const e=`${(new Date).toLocaleTimeString()} - VAD: Misfire (noise detected)`;g(t=>[...t.slice(-10),e]),it.onMisfire()}});(0,a.useEffect)(()=>{e&&s&&(it.setProjectId(s),it.setCallbacks({onUserSpeaking:()=>{$t.onUserSpeaking(),c("")},onProcessing:()=>{$t.onProcessing()},onAiSpeaking:()=>$t.onAiSpeaking(),onReset:()=>$t.reset(),onDebug:(e,t)=>{const s=`${(new Date).toLocaleTimeString()} - ${e}`;g(e=>[...e.slice(-10),s])},onError:e=>{const t=`${(new Date).toLocaleTimeString()} - ERROR: ${e}`;g(e=>[...e.slice(-10),t])},onTranscriptReceived:async e=>{c(e);const t=await v(parseInt(s),e),a={id:(0,l.$C)(),role:"user",content:e,timestamp:(new Date).toISOString(),status:"sent"};b(a.id),f(t.id.toString(),a);const n=`${(new Date).toLocaleTimeString()} - Added user message to chat: "${e}"`;g(e=>[...e.slice(-10),n])},onResponseReceived:async e=>{if(x){const t={id:(0,l.$C)(),role:"assistant",content:e,timestamp:(new Date).toISOString(),status:"sent",citations:[]};f(x.id.toString(),t);const s=`${(new Date).toLocaleTimeString()} - Added AI response to chat: "${e.substring(0,50)}..."`;g(e=>[...e.slice(-10),s])}}})),e||(it.clearConversation(),c(""),g([]))},[e,s]);const S=(0,a.useCallback)(async()=>{if(j.errored){const e=`${(new Date).toLocaleTimeString()} - VAD ERROR: Attempting to recover. Check browser console.`;g(t=>[...t.slice(-10),e]);try{return void setTimeout(()=>{j.listening||j.loading||j.start()},1e3)}catch(e){const t=`${(new Date).toLocaleTimeString()} - ERROR: VAD recovery failed. Try refreshing the page.`;return void g(e=>[...e.slice(-10),t])}}try{if(j.listening){j.pause();const e=`${(new Date).toLocaleTimeString()} - VAD paused`;g(t=>[...t.slice(-10),e])}else{try{const e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3}}),t=new AudioContext;t.createMediaStreamSource(e).disconnect(),t.close(),e.getTracks().forEach(e=>e.stop())}catch(e){const t=e instanceof Error?e.message:"Check permissions.",s=`${(new Date).toLocaleTimeString()} - ERROR: Microphone setup failed. ${t}`;return void g(e=>[...e.slice(-10),s])}try{j.start();const e=`${(new Date).toLocaleTimeString()} - VAD started successfully`;g(t=>[...t.slice(-10),e])}catch(e){const t=e instanceof Error?e.message:"Unknown error",s=`${(new Date).toLocaleTimeString()} - ERROR: VAD failed to start. ${t}`;g(e=>[...e.slice(-10),s])}}}catch(e){const t=`${(new Date).toLocaleTimeString()} - ERROR: ${e instanceof Error?e.message:"Failed to toggle VAD"}`;g(e=>[...e.slice(-10),t])}},[j]),N=(0,a.useCallback)(async()=>{try{if(u)h&&h.stop();else{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e),s=[];t.ondataavailable=e=>{e.data.size>0&&s.push(e.data)},t.onstop=async()=>{const t=new Blob(s,{type:"audio/wav"});try{const e=new AudioContext,s=await t.arrayBuffer(),a=(await e.decodeAudioData(s)).getChannelData(0),n=new Float32Array(a);it.onSpeechStart(),await it.onSpeechEnd(n),await e.close()}catch(e){const t=`${(new Date).toLocaleTimeString()} - Manual recording audio decode failed: ${e instanceof Error?e.message:"Unknown error"}`;g(e=>[...e.slice(-10),t])}e.getTracks().forEach(e=>e.stop()),m(!1),p(null)},p(t),m(!0),t.start();const a=`${(new Date).toLocaleTimeString()} - Manual recording started (VAD fallback)`;g(e=>[...e.slice(-10),a])}}catch(e){const t=`${(new Date).toLocaleTimeString()} - Manual recording failed: ${e instanceof Error?e.message:"Unknown error"}`;g(e=>[...e.slice(-10),t])}},[u,h]),[C,_]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(j.errored){const e=`${(new Date).toLocaleTimeString()} - VAD ERROR: Check console and microphone permissions`;return void g(t=>[...t.slice(-10),e])}if(e&&!j.loading&&!j.listening&&!j.errored&&!C){const e=`${(new Date).toLocaleTimeString()} - VAD loaded, attempting auto-start`;g(t=>[...t.slice(-10),e]),_(!0),setTimeout(()=>{S()},300)}if(e&&!j.loading&&j.errored&&C){const e=`${(new Date).toLocaleTimeString()} - VAD error detected, will attempt recovery`;g(t=>[...t.slice(-10),e]),setTimeout(()=>{j.errored&&!j.listening&&S()},1500)}!e&&j.listening&&j.pause()},[e,j.loading,j.listening,j.errored,C]),(0,a.useEffect)(()=>{e&&_(!1)},[e]),(0,a.useEffect)(()=>{i(j.loading)},[j.loading]),(0,w.jsx)(w.Fragment,{children:e&&(0,w.jsx)("div",{className:"fixed inset-0 z-50 bg-black",children:r?(0,w.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,w.jsx)(st(),{loading:r,color:"#27eab6","aria-label":"Loading Voice","data-testid":"loader"})}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(nt,{draw:$t.draw}),(0,w.jsx)("button",{onClick:t,className:"absolute top-8 right-8 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-sm flex items-center justify-center transition-colors","aria-label":"Close voice mode",children:(0,w.jsx)(B.A,{className:"w-6 h-6 text-white"})}),(0,w.jsxs)("div",{className:"absolute bottom-12 left-1/2 transform -translate-x-1/2 flex gap-4",children:[(0,w.jsx)("button",{onClick:S,className:"px-8 py-4 rounded-full font-medium transition-all transform hover:scale-105 "+(j.listening?"bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-500/50":"bg-white/10 hover:bg-white/20 text-white backdrop-blur-sm"),children:j.listening?"Pause":"Resume"}),j.errored&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("button",{onClick:N,className:"px-6 py-4 rounded-full font-medium transition-all transform hover:scale-105 "+(u?"bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-500/50":"bg-green-500 hover:bg-green-600 text-white"),children:u?"Stop Recording":"Manual Record"}),(0,w.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-4 rounded-full font-medium bg-blue-500 hover:bg-blue-600 text-white transition-all transform hover:scale-105",children:"Reload & Retry"})]})]}),(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-center pointer-events-none",children:[(0,w.jsx)("p",{className:"text-2xl font-light mb-2",children:u?"Recording...":j.errored?"Error - Try Manual Mode":j.listening?"Listening...":"Paused"}),j.errored&&!u&&(0,w.jsx)("p",{className:"text-sm text-red-300 max-w-md mx-auto mb-2",children:'VAD worklet failed to load. Use "Manual Record" button below or reload page.'}),u&&(0,w.jsx)("p",{className:"text-sm text-green-300 max-w-md mx-auto mb-2",children:'Press "Stop Recording" when you finish speaking.'}),o&&(0,w.jsxs)("p",{className:"text-lg text-white/70 max-w-md mx-auto",children:['"',o,'"']})]}),(0,w.jsx)("div",{className:"absolute bottom-32 left-8 right-8 max-w-2xl mx-auto max-h-40 overflow-y-auto bg-black/30 backdrop-blur-sm rounded-lg p-4",children:(0,w.jsxs)("div",{className:"text-xs text-green-400 font-mono space-y-1",children:[(0,w.jsxs)("div",{className:""+(j.errored?"text-red-400":"text-yellow-400"),children:["VAD Status: ",j.loading?"Loading...":j.errored?"ERROR":j.listening?"Listening":"Paused"]}),(0,w.jsxs)("div",{className:"text-yellow-400",children:["User Speaking: ",j.userSpeaking?"Yes":"No"]}),(0,w.jsxs)("div",{className:"text-yellow-400",children:["Project ID: ",s||"Not Set"]}),(0,w.jsxs)("div",{className:""+(j.errored?"text-red-400":"text-blue-400"),children:["VAD Error: ",j.errored?"Yes - Check microphone permissions":"No"]}),(0,w.jsx)("div",{className:"text-blue-400",children:"Model Files: /silero_vad.onnx, /vad.worklet.bundle.min.js"}),d.length>0?d.slice(-6).map((e,t)=>(0,w.jsx)("div",{className:"opacity-90 "+(e.includes("ERROR")?"text-red-300":""),children:e},t)):(0,w.jsx)("div",{className:"text-gray-400",children:"Initializing VAD... Check console for details"})]})})]})})})}const Dt=["What can you help me with?","Explain this document","Summarize key points","Answer my questions"],Lt=({prompt:e,onClick:t})=>(0,w.jsx)("button",{onClick:()=>t(e),className:"p-3 text-left bg-card border border-border rounded-lg hover:border-accent hover:shadow-sm transition-all text-sm text-card-foreground",children:e}),Ut=({onPromptClick:e})=>{const{currentAgent:t}=Ze(),[s,n]=(0,a.useState)(Dt),[r,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{(async()=>{if(t)if(t.settings?.example_questions&&t.settings.example_questions.length>0)n(t.settings.example_questions);else{i(!0);try{const e=(0,xe.KU)(),s=await e.getAgentSettings(t.id),a=s.data||s;a.example_questions&&a.example_questions.length>0?(n(a.example_questions),Ne.v.info("UI","Loaded custom example questions from API",{agentId:t.id,questionCount:a.example_questions.length})):Ne.v.info("UI","No custom example questions found, using defaults",{agentId:t.id})}catch(e){Ne.v.warn("UI","Failed to load agent settings for example questions",{agentId:t.id,error:e instanceof Error?e.message:String(e)})}finally{i(!1)}}})()},[t]),(0,w.jsx)("div",{className:"flex flex-col items-center justify-center h-full px-4 py-8",children:(0,w.jsxs)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-md",children:[(0,w.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto",children:(0,w.jsx)("img",{src:"/logo.png",alt:"CustomGPT.ai Logo",className:"w-16 h-16 rounded-full"})}),(0,w.jsxs)("h3",{className:"text-xl font-semibold text-foreground mb-2",children:["Welcome to ",t?.project_name||"CustomGPT","!"]}),(0,w.jsx)("p",{className:"text-muted-foreground mb-8",children:"I'm here to help answer your questions and assist with your tasks. How can I help you today?"}),(0,w.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full",children:s.map((s,a)=>(0,w.jsx)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1+.1*a},children:(0,w.jsx)(Lt,{prompt:s,onClick:e})},`${t?.id}-${a}`))}),r&&(0,w.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4",children:(0,w.jsx)("p",{className:"text-xs text-muted-foreground",children:"Loading custom questions..."})})]})})},qt=({className:e})=>{const{messages:t,streamingMessage:s,isStreaming:n,error:r,sendMessage:i,updateMessageFeedback:o,loading:c}=Xe(),{currentConversation:d}=Qe(),{currentAgent:g}=Ze(),u=(0,a.useRef)(null),[m,h]=a.useState(!1),[p,f]=a.useState(null),[x,v]=a.useState(null),[y,b]=a.useState(!1),[j,S]=a.useState(null),[N,C]=a.useState(!1),_=d&&t.get(d.id.toString())||[];(0,a.useEffect)(()=>{if(d&&d.id.toString()!==p){h(!0),f(d.id.toString());const e=setTimeout(()=>{h(!1)},1e3);return()=>clearTimeout(e)}},[d,p]),(0,a.useEffect)(()=>{m&&(_.length>0||!c)&&h(!1)},[_,m,c]),(0,a.useEffect)(()=>{if(u.current){const e=m?"auto":"smooth";u.current.scrollTo({top:u.current.scrollHeight,behavior:e})}},[_,s,m]);const A=e=>{Ne.v.info("UI","Citation clicked",{citationId:e.id,citationIndex:e.index,citationTitle:e.title}),e.id&&(v(e.id),b(!0))},E=e=>{Ne.v.info("UI","Citation preview requested",{citationId:e.id,citationTitle:e.title}),e.id&&(S(e.id),C(!0))};return(0,w.jsxs)("div",{ref:u,className:(0,l.cn)("flex-1 overflow-y-auto scroll-smooth","bg-gradient-to-b from-muted/50 to-background",e),children:[r&&(0,w.jsx)("div",{className:"p-4 m-4",children:(0,w.jsx)(Le,{error:r,onRetry:()=>{const e=(d&&t.get(d.id.toString())||[]).filter(e=>"user"===e.role).pop();e&&"error"===e.status&&i(e.content)}})}),m&&(0,w.jsx)(Z,{visible:!0,message:_.length>0?"Loading conversation...":"Switching to conversation...",blur:!0}),m&&0===_.length&&!n&&(0,w.jsxs)("div",{className:"space-y-0 opacity-30",children:[(0,w.jsx)(ee,{isAssistant:!1,lines:2}),(0,w.jsx)(ee,{isAssistant:!0,lines:3}),(0,w.jsx)(ee,{isAssistant:!1,lines:1}),(0,w.jsx)(ee,{isAssistant:!0,lines:4})]}),0===_.length&&!s&&!r&&!m&&(0,w.jsx)(Ut,{onPromptClick:e=>{Ne.v.info("UI","Example prompt clicked",{prompt:e}),i(e)}}),_.length>0&&(0,w.jsx)("div",{className:"space-y-0",children:_.map((e,t)=>(0,w.jsx)(K,{message:e,agent:g,isLast:t===_.length-1,onCitationClick:A,onPreviewClick:E,onFeedback:t=>(async(e,t)=>{Ne.v.info("UI","Message feedback provided",{messageId:e,feedback:t}),await o(e,t)})(e.id,t)},e.id))}),s&&(0,w.jsx)(K,{message:s,agent:g,isStreaming:!0,isLast:!0,onCitationClick:A,onPreviewClick:E}),n&&!s&&(0,w.jsx)(ue,{}),x&&(0,w.jsx)(_e,{isOpen:y,onClose:()=>{b(!1),v(null)},citationId:x,projectId:g?.id}),j&&(0,w.jsx)(Ee,{isOpen:N,onClose:()=>{C(!1),S(null)},citationId:j,fileName:`Citation_${j}.txt`})]})},zt=({mode:e="standalone",onClose:t,onAgentSettings:s,enableConversationManagement:a=!1,maxConversations:n,sessionId:r,currentConversationId:i,onConversationChange:o,onCreateConversation:l,conversationRefreshKey:d})=>{const{currentAgent:g}=Ze();return"widget"===e||"floating"===e?(0,w.jsxs)("header",{className:"border-b border-border bg-background",children:[a&&r&&(0,w.jsx)("div",{className:"px-4 py-2 border-b border-border",children:(0,w.jsx)(Re,{sessionId:r,maxConversations:n,currentConversationId:i,onConversationChange:o,onCreateConversation:l,className:"w-full",refreshKey:d})}),(0,w.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,w.jsx)("img",{src:"/logo.png",alt:"CustomGPT.ai Logo",className:"w-8 h-8 rounded-lg"})}),(0,w.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,w.jsx)("h2",{className:"font-semibold text-foreground truncate",children:g?.project_name||"CustomGPT Assistant"}),(0,w.jsx)("p",{className:"text-xs text-muted-foreground",children:g?.is_chat_active?"Online":"Offline"})]})]}),t&&(0,w.jsxs)("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-accent hover:text-accent-foreground transition-colors flex-shrink-0",children:[(0,w.jsx)("span",{className:"sr-only",children:"Close"}),"×"]})]})]}):"standalone"===e?(0,w.jsxs)("header",{className:"flex items-center justify-between px-4 py-3 border-b border-border bg-background",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-lg bg-brand-500 flex items-center justify-center",children:(0,w.jsx)(c.A,{className:"w-5 h-5 text-white"})}),(0,w.jsx)("h1",{className:"text-lg font-semibold text-foreground",children:"Agent Chat"})]}),(0,w.jsx)("div",{className:"flex-1 max-w-xs ml-4",children:(0,w.jsx)(we,{onSettingsClick:s,className:"w-full"})})]}):null},Kt=({mode:e="standalone",className:t,onClose:s,onAgentSettings:n,enableConversationManagement:i=!1,maxConversations:o,sessionId:c,threadId:d,onConversationChange:g,onMessage:u,conversationRefreshKey:m})=>{const{sendMessage:h,isStreaming:p,cancelStreaming:f}=Xe(),{fetchAgents:x,agents:v,currentAgent:y}=Ze(),{currentConversation:b}=Qe(),j=(0,a.useContext)(Ue)||null,[S,N]=a.useState(null),[C,_]=a.useState(!1);(0,a.useEffect)(()=>{(async()=>{if(0!==v.length||y)Ne.v.info("UI","Agents already initialized",{agentCount:v.length,hasCurrentAgent:!!y,currentAgentName:y?.project_name});else{Ne.v.info("UI","Initializing agents on ChatContainer mount");try{await x(),Ne.v.info("UI","Agents initialized successfully",{agentCount:v.length})}catch(e){Ne.v.error("UI","Failed to initialize agents",e,{errorMessage:e instanceof Error?e.message:String(e)})}}})()},[]);return(0,w.jsxs)("div",{className:(0,l.cn)("flex flex-col bg-background","standalone"===e&&"h-full","widget"===e&&"h-[600px] w-[400px] rounded-lg shadow-xl border border-border","floating"===e&&"h-[600px] w-[400px] rounded-lg shadow-2xl border border-border",t),children:[(0,w.jsx)(zt,{mode:e,onClose:s,onAgentSettings:e=>{Ne.v.info("UI","Agent settings requested",{agentId:e.id,agentName:e.project_name}),n?.(e)},enableConversationManagement:i,maxConversations:o,sessionId:c,currentConversationId:S||b?.id.toString(),onConversationChange:e=>{N(e.id),g?.(e),j&&j.switchConversation(e.id)},onCreateConversation:()=>{if(j){const e=j.createConversation();if(e)N(e.id);else{const e=j.configuration?.maxConversations||5;r.oR.error(`You've reached the maximum limit of ${e} conversations. Please delete an existing conversation to create a new one.`)}}},conversationRefreshKey:m}),(0,w.jsx)(qt,{className:"flex-1"}),(0,w.jsx)(ge,{onSend:async(e,t)=>{Ne.v.info("UI","Sending message from ChatContainer",{contentLength:e.length,hasFiles:t&&t.length>0,fileCount:t?.length||0,currentAgent:y?.project_name,agentId:y?.id});try{await h(e,t),Ne.v.info("UI","Message sent successfully")}catch(e){Ne.v.error("UI","Failed to send message from ChatContainer",e,{errorMessage:e instanceof Error?e.message:String(e),isAuthError:e instanceof Error&&(e.message.includes("403")||e.message.includes("unauthorized"))})}},disabled:p,placeholder:p?"AI is thinking...":"Send a message...",onVoiceClick:()=>_(!0)}),("widget"===e||"floating"===e)&&(0,w.jsx)("div",{className:"px-4 py-2 border-t border-border bg-muted",children:(0,w.jsx)("a",{href:"https://customgpt.ai",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-muted-foreground hover:text-foreground transition-colors block text-center",children:"Powered by CustomGPT.ai"})}),y&&(0,w.jsx)(Ft,{isOpen:C,onClose:()=>_(!1),projectId:y.id.toString(),projectName:y.project_name})]})};var Gt=s(7600),Vt=s.n(Gt),Bt=s(1793),Jt=s(2923),Yt=s(348),Wt=s(6846),Ht=s(5436),Xt=s(1714),Qt=s(3252),Zt=s(7572);const es=({conversation:e,isOpen:t,onClose:s,onExport:a,onShare:n})=>{if(!t||!e)return null;const i=(e,t)=>{navigator.clipboard.writeText(e),r.oR.success(`${t} copied to clipboard`)},c=e=>new Date(e).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"});return(0,w.jsx)(I.N,{children:t&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),(0,w.jsxs)(o.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-x-0 top-[10%] mx-auto max-w-2xl bg-white rounded-lg shadow-xl z-50 max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,w.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,w.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Conversation Details"}),(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:s,className:"h-8 w-8",children:(0,w.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,w.jsxs)("div",{className:"p-6 space-y-6 overflow-y-auto max-h-[calc(80vh-200px)]",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider mb-3",children:"Basic Information"}),(0,w.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Xt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Conversation Name"})]}),(0,w.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:e.name})]}),(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Xt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Conversation ID"})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{className:"text-sm text-gray-900 font-mono",children:e.id}),(0,w.jsx)(j,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>i(e.id.toString(),"Conversation ID"),children:(0,w.jsx)(p.A,{className:"h-3 w-3"})})]})]}),(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Xt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Session ID"})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{className:"text-sm text-gray-900 font-mono truncate max-w-[300px]",title:e.session_id,children:e.session_id}),(0,w.jsx)(j,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>i(e.session_id,"Session ID"),children:(0,w.jsx)(p.A,{className:"h-3 w-3"})})]})]}),(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Xt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Project ID"})]}),(0,w.jsx)("span",{className:"text-sm text-gray-900",children:e.project_id})]}),void 0!==e.message_count&&(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Xt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Message Count"})]}),(0,w.jsxs)("span",{className:"text-sm text-gray-900",children:[e.message_count," messages"]})]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider mb-3",children:"Timeline"}),(0,w.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Qt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Created At"})]}),(0,w.jsxs)("div",{className:"text-right",children:[(0,w.jsx)("span",{className:"text-sm text-gray-900 block",children:c(e.created_at)}),(0,w.jsxs)("span",{className:"text-xs text-gray-500",children:["(",(0,l.Ey)(e.created_at),")"]})]})]}),(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(Bt.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Last Updated"})]}),(0,w.jsxs)("div",{className:"text-right",children:[(0,w.jsx)("span",{className:"text-sm text-gray-900 block",children:c(e.updated_at)}),(0,w.jsxs)("span",{className:"text-xs text-gray-500",children:["(",(0,l.Ey)(e.updated_at),")"]})]})]}),e.deleted_at&&(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(V.A,{className:"h-4 w-4 text-red-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-red-700",children:"Deleted At"})]}),(0,w.jsxs)("div",{className:"text-right",children:[(0,w.jsx)("span",{className:"text-sm text-red-900 block",children:c(e.deleted_at)}),(0,w.jsxs)("span",{className:"text-xs text-red-500",children:["(",(0,l.Ey)(e.deleted_at),")"]})]})]})]})]}),e.created_by&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider mb-3",children:"User Information"}),(0,w.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,w.jsxs)("div",{className:"flex items-start justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)(S.A,{className:"h-4 w-4 text-gray-400"}),(0,w.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Created By"})]}),(0,w.jsxs)("span",{className:"text-sm text-gray-900",children:["User ID: ",e.created_by]})]})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider mb-3",children:"Actions"}),(0,w.jsxs)("div",{className:"flex gap-3",children:[a&&(0,w.jsxs)(j,{variant:"outline",onClick:()=>a(e),className:"flex items-center gap-2",children:[(0,w.jsx)(Ae.A,{className:"h-4 w-4"}),"Export Conversation"]}),n&&(0,w.jsxs)(j,{variant:"outline",onClick:()=>n(e),className:"flex items-center gap-2",children:[(0,w.jsx)(Zt.A,{className:"h-4 w-4"}),"Share Conversation"]})]})]})]}),(0,w.jsx)("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:(0,w.jsx)("div",{className:"flex justify-end",children:(0,w.jsx)(j,{onClick:s,children:"Close"})})})]})]})})};var ts=s(5367);const ss=({isOpen:e,conversationName:t,messageCount:s,onConfirm:n,onCancel:r})=>{const[i,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(null);return e?(0,w.jsx)(I.N,{children:e&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:i?void 0:r}),(0,w.jsx)(o.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white rounded-lg shadow-xl z-50",onClick:e=>e.stopPropagation(),children:(0,w.jsxs)("div",{className:"p-6",children:[(0,w.jsxs)("div",{className:"flex items-start gap-4",children:[(0,w.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,w.jsx)(ts.A,{className:"w-6 h-6 text-red-600"})}),(0,w.jsxs)("div",{className:"flex-1",children:[(0,w.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Conversation"}),(0,w.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Are you sure you want to delete ",(0,w.jsxs)("strong",{children:['"',t,'"']}),"?"]}),void 0!==s&&s>0&&(0,w.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["This conversation contains ",s," message",1!==s?"s":"","."]}),(0,w.jsxs)("div",{className:"mt-3 p-3 bg-red-50 rounded-lg",children:[(0,w.jsx)("p",{className:"text-sm text-red-800 font-medium",children:"⚠️ This action cannot be undone"}),(0,w.jsx)("p",{className:"text-xs text-red-700 mt-1",children:"All messages and data associated with this conversation will be permanently deleted."})]}),l&&(0,w.jsx)("div",{className:"mt-3 p-3 bg-red-100 border border-red-200 rounded-lg",children:(0,w.jsxs)("p",{className:"text-sm text-red-900 font-medium",children:["Error: ",l]})})]})]}),(0,w.jsxs)("div",{className:"mt-6 flex items-center gap-3 justify-end",children:[(0,w.jsx)(j,{variant:"outline",onClick:r,disabled:i,children:"Cancel"}),(0,w.jsx)(j,{variant:"destructive",onClick:async()=>{c(!0),d(null);try{await n()}catch(e){let t="Failed to delete conversation";400===e.status?t="Invalid request. Please try again.":401===e.status?t="Authentication failed. Please refresh the page and try again.":404===e.status?t="Conversation not found. It may have already been deleted.":500===e.status?t="Server error. Please try again later.":e.message&&(t=e.message),d(t),c(!1)}},disabled:i,className:"min-w-[100px]",children:i?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Pe.A,{className:"w-4 h-4 mr-2"}),"Delete"]})})]})]})})]})}):null},as=({conversation:e,isSelected:t,onSelect:s,onDelete:n,onRename:i})=>{const[c,d]=(0,a.useState)(!1),[g,u]=(0,a.useState)(e.name),[m,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),[x,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[S,N]=(0,a.useState)(!1),C=(0,a.useRef)(null),_=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=e=>{_.current&&!_.current.contains(e.target)&&h(!1)};if(m)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[m]),(0,a.useEffect)(()=>{c&&C.current&&(C.current.focus(),C.current.select())},[c]);const A=()=>{g.trim()&&g.trim()!==e.name&&i(e.id.toString(),g.trim()),d(!1),u(e.name)};return(0,w.jsxs)("div",{className:(0,l.cn)("group relative p-3 rounded-lg cursor-pointer transition-colors","hover:bg-accent",t&&"bg-accent/50 hover:bg-accent/70"),onClick:async()=>{if(!c&&!S){N(!0);try{await s(e)}finally{N(!1)}}},children:[S&&(0,w.jsx)("div",{className:"absolute inset-0 bg-background/70 backdrop-blur-sm rounded-lg flex items-center justify-center z-10",children:(0,w.jsx)(X,{size:"sm"})}),(0,w.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[c?(0,w.jsx)("input",{ref:C,type:"text",value:g,onChange:e=>u(e.target.value),onBlur:A,onKeyDown:t=>{"Enter"===t.key?A():"Escape"===t.key&&(d(!1),u(e.name))},className:"w-full px-2 py-1 text-sm font-medium text-foreground bg-background border border-input rounded focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",maxLength:100}):(0,w.jsx)("h3",{className:"font-medium text-foreground text-sm truncate",children:e.name}),(0,w.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[(0,w.jsx)(Bt.A,{className:"w-3 h-3"}),(0,w.jsx)("span",{title:new Date(e.updated_at).toLocaleString(),children:(0,l.Ey)(e.updated_at)}),void 0!==e.message_count&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("span",{children:"•"}),(0,w.jsx)(Jt.A,{className:"w-3 h-3"}),(0,w.jsx)("span",{children:e.message_count})]})]}),(0,w.jsx)("button",{onClick:e=>{e.stopPropagation(),f(!p)},className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground hover:text-foreground transition-colors",children:p?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)($.A,{className:"w-3 h-3"}),"Hide Details"]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(k.A,{className:"w-3 h-3"}),"More Details"]})}),(0,w.jsx)(I.N,{children:p&&(0,w.jsx)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"mt-2 pt-2 border-t border-border",children:(0,w.jsxs)("div",{className:"space-y-1 text-xs text-muted-foreground",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("span",{children:"Session ID:"}),(0,w.jsx)("span",{className:"font-mono text-foreground truncate max-w-[150px]",title:e.session_id,children:e.session_id})]}),(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("span",{children:"Created:"}),(0,w.jsx)("span",{className:"text-foreground",children:(0,l.Ey)(e.created_at)})]}),e.deleted_at&&(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("span",{className:"text-destructive",children:"Deleted:"}),(0,w.jsx)("span",{className:"text-destructive",children:(0,l.Ey)(e.deleted_at)})]})]})})})]}),!c&&(0,w.jsxs)("div",{className:"relative",ref:_,children:[(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:e=>{e.stopPropagation(),h(!m)},className:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-muted-foreground hover:text-foreground",children:(0,w.jsx)(Yt.A,{className:"h-3 w-3"})}),(0,w.jsx)(I.N,{children:m&&(0,w.jsx)(o.P.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},transition:{duration:.1},className:"absolute right-0 top-6 mt-1 w-40 bg-background border border-border rounded-lg shadow-lg z-50",children:(0,w.jsxs)("div",{className:"py-1",children:[(0,w.jsxs)("button",{onClick:e=>{e.stopPropagation(),v(!0),h(!1)},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-foreground hover:bg-accent",children:[(0,w.jsx)(O.A,{className:"w-3 h-3"}),"View Details"]}),(0,w.jsxs)("button",{onClick:e=>{e.stopPropagation(),d(!0),h(!1)},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-foreground hover:bg-accent",children:[(0,w.jsx)(Wt.A,{className:"w-3 h-3"}),"Rename"]}),(0,w.jsx)("div",{className:"border-t border-border my-1"}),(0,w.jsxs)("button",{onClick:e=>{e.stopPropagation(),b(!0),h(!1)},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-destructive hover:bg-destructive/10",children:[(0,w.jsx)(Pe.A,{className:"w-3 h-3"}),"Delete"]})]})})})]})]}),(0,w.jsx)(es,{conversation:e,isOpen:x,onClose:()=>v(!1),onExport:e=>{const t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`conversation-${e.id}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),r.oR.success("Conversation exported successfully")},onShare:e=>{const t=`${window.location.origin}/chat/${e.session_id}`;navigator.clipboard.writeText(t),r.oR.success("Share link copied to clipboard")}}),(0,w.jsx)(ss,{isOpen:y,conversationName:e.name,messageCount:e.message_count,onConfirm:async()=>{await n(e.id.toString()),b(!1)},onCancel:()=>b(!1)})]})},ns=({className:e,isCollapsed:t=!1,onToggle:s})=>{const[n,i]=(0,a.useState)(""),[d,g]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)("name"),[f,x]=(0,a.useState)("all"),{conversations:v,currentConversation:y,loading:b,error:S,fetchConversations:N,createConversation:C,selectConversation:_,deleteConversation:A,updateConversation:E,currentPage:M,totalPages:P,totalConversations:R,perPage:T,sortOrder:O,sortBy:F,userFilter:D}=Qe(),{currentAgent:L}=Ze(),{clearMessages:U,loadMessages:q}=Xe();(0,a.useEffect)(()=>{const e="undefined"!=typeof window&&window.__customgpt_demo_mode;L&&!e?(Ne.v.info("UI","Agent changed in sidebar, fetching conversations",{agentId:L.id,agentName:L.project_name,isActive:L.is_chat_active}),N(L.id)):L?e&&Ne.v.info("UI","Skipping conversation fetch in demo mode"):Ne.v.warn("UI","No current agent selected in sidebar")},[L,N]);const z=Array.isArray(v)?v.filter(e=>{if(n){const t=n.toLowerCase();switch(h){case"name":if(!e.name.toLowerCase().includes(t))return!1;break;case"id":if(!e.id.toString().includes(t))return!1;break;case"session":if(!e.session_id.toLowerCase().includes(t))return!1}}if("all"!==f){const t=new Date(e.updated_at),s=new Date,a=Math.floor((s.getTime()-t.getTime())/864e5);switch(f){case"today":if(a>0)return!1;break;case"week":if(a>7)return!1;break;case"month":if(a>30)return!1}}return!0}):[],K=async e=>{if(!b){Ne.v.info("UI","Selecting conversation",{conversationId:e.id,conversationName:e.name,projectId:e.project_id,messageCount:e.message_count}),_(e);try{Ne.v.info("UI","Loading messages for selected conversation",{conversationId:e.id,agentId:L?.id,agentName:L?.project_name}),await q(e.id.toString()),Ne.v.info("UI","Messages loaded successfully for conversation",{conversationId:e.id})}catch(t){Ne.v.error("UI","Failed to load messages for conversation",t,{conversationId:e.id,errorMessage:t instanceof Error?t.message:String(t),errorType:t instanceof Error?t.constructor.name:typeof t}),r.oR.error("Failed to load conversation messages")}}},G=async(e,t)=>{const s=v.find(t=>t.id.toString()===e);if(s)try{await E(s.project_id,s.session_id,{name:t}),r.oR.success("Conversation renamed")}catch(e){r.oR.error("Failed to rename conversation")}};return t?(0,w.jsx)("div",{className:(0,l.cn)("w-12 bg-muted border-r border-border flex flex-col",e),children:(0,w.jsx)("div",{className:"p-2",children:(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:s,className:"w-8 h-8",title:"Expand sidebar",children:(0,w.jsx)(Jt.A,{className:"h-4 w-4"})})})}):(0,w.jsxs)("div",{className:(0,l.cn)("w-80 bg-muted border-r border-border flex flex-col",e),children:[(0,w.jsxs)("div",{className:"p-4 border-b border-border bg-background",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,w.jsx)("h2",{className:"font-semibold text-foreground",children:"Conversations"}),(0,w.jsx)(j,{size:"icon",variant:"ghost",onClick:s,className:"h-8 w-8",title:"Collapse sidebar",children:(0,w.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsxs)("div",{className:"relative",children:[(0,w.jsx)(Oe.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,w.jsx)("input",{type:"text",placeholder:`Search by ${h}...`,value:n,onChange:e=>i(e.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent placeholder:text-muted-foreground"})]}),(0,w.jsxs)("div",{className:"flex gap-1",children:[(0,w.jsx)("button",{onClick:()=>p("name"),className:(0,l.cn)("flex-1 px-2 py-1 text-xs rounded transition-colors","name"===h?"bg-brand-500 text-white":"bg-muted text-muted-foreground hover:bg-accent"),children:"Name"}),(0,w.jsx)("button",{onClick:()=>p("id"),className:(0,l.cn)("flex-1 px-2 py-1 text-xs rounded transition-colors","id"===h?"bg-brand-500 text-white":"bg-muted text-muted-foreground hover:bg-accent"),children:"ID"}),(0,w.jsx)("button",{onClick:()=>p("session"),className:(0,l.cn)("flex-1 px-2 py-1 text-xs rounded transition-colors","session"===h?"bg-brand-500 text-white":"bg-muted text-muted-foreground hover:bg-accent"),children:"Session"})]})]}),(0,w.jsxs)(j,{size:"sm",variant:"outline",onClick:()=>m(!u),className:"w-full mt-2 justify-center gap-2",children:[(0,w.jsx)(Ht.A,{className:"h-3 w-3"}),"Sort & Filter",u?(0,w.jsx)($.A,{className:"h-3 w-3"}):(0,w.jsx)(k.A,{className:"h-3 w-3"})]}),(0,w.jsx)(I.N,{children:u&&(0,w.jsxs)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-3 mt-3 overflow-hidden",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-xs font-medium text-foreground mb-1 block",children:"Sort By"}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,w.jsxs)("select",{value:F,onChange:e=>{L&&N(L.id,{page:1,orderBy:e.target.value})},className:"px-2 py-1 text-xs border border-input bg-background text-foreground rounded focus:outline-none focus:ring-2 focus:ring-ring",children:[(0,w.jsx)("option",{value:"id",children:"Date Created"}),(0,w.jsx)("option",{value:"updated_at",children:"Last Updated"}),(0,w.jsx)("option",{value:"name",children:"Name"})]}),(0,w.jsxs)("select",{value:O,onChange:e=>{L&&N(L.id,{page:1,order:e.target.value})},className:"px-2 py-1 text-xs border border-input bg-background text-foreground rounded focus:outline-none focus:ring-2 focus:ring-ring",children:[(0,w.jsx)("option",{value:"desc",children:"Newest First"}),(0,w.jsx)("option",{value:"asc",children:"Oldest First"})]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-xs font-medium text-foreground mb-1 block",children:"Filter By Date"}),(0,w.jsxs)("select",{value:f,onChange:e=>x(e.target.value),className:"w-full px-2 py-1 text-xs border border-input bg-background text-foreground rounded focus:outline-none focus:ring-2 focus:ring-ring",children:[(0,w.jsx)("option",{value:"all",children:"All Time"}),(0,w.jsx)("option",{value:"today",children:"Today"}),(0,w.jsx)("option",{value:"week",children:"Last 7 Days"}),(0,w.jsx)("option",{value:"month",children:"Last 30 Days"})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-xs font-medium text-foreground mb-1 block",children:"Filter By User"}),(0,w.jsx)("select",{value:D,onChange:e=>{L&&N(L.id,{page:1,userFilter:e.target.value})},className:"w-full px-2 py-1 text-xs border border-input bg-background text-foreground rounded focus:outline-none focus:ring-2 focus:ring-ring",children:(0,w.jsx)("option",{value:"all",children:"All Users"})})]})]})})]}),(0,w.jsxs)("div",{className:"p-4 space-y-2",children:[(0,w.jsx)(Vt(),{href:"/dashboard/projects/create",children:(0,w.jsxs)(j,{className:"w-full justify-start gap-2",variant:"default",children:[(0,w.jsx)(c.A,{className:"w-4 h-4"}),"Create New Agent"]})}),(0,w.jsx)(j,{onClick:async()=>{if(L&&!d){Ne.v.info("UI","Creating new conversation",{agentId:L.id,agentName:L.project_name}),g(!0);try{const e=`New Chat ${(new Date).toLocaleDateString()}`;await C(L.id,e),U(),Ne.v.info("UI","New conversation created successfully",{name:e}),r.oR.success("New conversation created")}catch(e){Ne.v.error("UI","Failed to create conversation",e,{agentId:L.id,errorMessage:e instanceof Error?e.message:String(e)}),r.oR.error("Failed to create new conversation")}finally{g(!1)}}},disabled:!L||d,className:"w-full justify-start gap-2",variant:"outline",children:d?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(X,{size:"sm"}),(0,w.jsx)("span",{children:"Creating..."})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ke.A,{className:"w-4 h-4"}),(0,w.jsx)("span",{children:"New Chat"})]})})]}),(0,w.jsx)("div",{className:"flex-1 overflow-y-auto",children:!b||Array.isArray(v)&&0!==v.length?!S||Array.isArray(v)&&0!==v.length?0===z.length?(0,w.jsxs)("div",{className:"p-4 text-center",children:[(0,w.jsx)(Jt.A,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),(0,w.jsx)("p",{className:"text-sm text-muted-foreground",children:n?"No conversations found":"No conversations yet"}),!n&&(0,w.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Start a new conversation to get going"}),L&&(0,w.jsxs)("div",{className:"text-xs text-muted-foreground mt-2 space-y-1",children:[(0,w.jsxs)("p",{children:["Agent: ",L.project_name," (ID: ",L.id,")"]}),S&&(0,w.jsxs)("p",{className:"text-destructive",children:["Error: ",S]}),(0,w.jsxs)("p",{children:["Conversations loaded: ",v.length]})]})]}):(0,w.jsx)("div",{className:"p-2 space-y-1",children:z.map(e=>(0,w.jsx)(as,{conversation:e,isSelected:y?.id===e.id,onSelect:K,onDelete:e=>(async e=>{try{await A(e),r.oR.success("Conversation deleted")}catch(e){r.oR.error("Failed to delete conversation")}})(e),onRename:G},e.id))}):(0,w.jsxs)("div",{className:"p-4 text-center",children:[(0,w.jsx)("p",{className:"text-sm text-destructive mb-2",children:"Failed to load conversations"}),(0,w.jsx)(j,{size:"sm",variant:"ghost",onClick:()=>L&&N(L.id),children:"Try Again"})]}):(0,w.jsx)(te,{count:5})}),(0,w.jsxs)("div",{className:"p-4 border-t border-border bg-background space-y-3",children:[(0,w.jsxs)("div",{className:"text-xs text-muted-foreground text-center",children:[n?(0,w.jsxs)(w.Fragment,{children:[z.length," result",1!==z.length?"s":""]}):(0,w.jsxs)(w.Fragment,{children:["Showing ",v.length," of ",R," conversation",1!==R?"s":""]}),L&&(0,w.jsxs)("span",{className:"block mt-1",children:["Agent: ",L.project_name]})]}),P>1&&!n&&(0,w.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,w.jsx)(j,{size:"sm",variant:"outline",onClick:()=>{L&&M>1&&N(L.id,{page:M-1})},disabled:1===M||b,children:(0,w.jsx)(k.A,{className:"h-3 w-3 rotate-90"})}),(0,w.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Page ",M," of ",P]}),(0,w.jsx)(j,{size:"sm",variant:"outline",onClick:()=>{L&&M<P&&N(L.id,{page:M+1})},disabled:M===P||b,children:(0,w.jsx)(k.A,{className:"h-3 w-3 -rotate-90"})})]})]})]})},rs=({mode:e="standalone",className:t,onClose:s,onAgentSettings:n,showSidebar:r=!0,enableConversationManagement:i=!1,maxConversations:o,sessionId:c,threadId:l,onConversationChange:d,onMessage:g,widgetInstance:u,conversations:m,currentConversation:h,conversationRefreshKey:p})=>{const[f,x]=(0,a.useState)(!1),{currentConversation:v}=Qe(),{loadMessages:y}=Xe();(0,a.useEffect)(()=>{const e="undefined"!=typeof window&&window.__customgpt_demo_mode;v&&!e&&y(v.id.toString())},[v,y]);return r&&"standalone"===e?(0,w.jsxs)("div",{className:"flex h-full bg-white",children:[(0,w.jsx)(ns,{isCollapsed:f,onToggle:()=>{x(!f)}}),(0,w.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:(0,w.jsx)(Kt,{mode:e,className:"h-full",onClose:s,onAgentSettings:n,enableConversationManagement:i,maxConversations:o,sessionId:c,threadId:l,onConversationChange:d,onMessage:g,conversationRefreshKey:p})})]}):(0,w.jsx)(Kt,{mode:e,className:t,onClose:s,onAgentSettings:n,enableConversationManagement:i,maxConversations:o,sessionId:c,threadId:l,onConversationChange:d,onMessage:g,conversationRefreshKey:p})};function is(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class os{constructor(e){if(is(this,"container",null),is(this,"root",null),is(this,"config",void 0),is(this,"isOpen",!1),is(this,"sessionId",void 0),is(this,"currentConversationId",null),is(this,"instanceKey",void 0),is(this,"conversationRefreshKey",0),!e.agentId)throw new Error("CustomGPT Widget: Agent ID is required");if(this.config={mode:"embedded",theme:"light",position:"bottom-right",width:"400px",height:"600px",enableCitations:!0,enableFeedback:!0,enableConversationManagement:!1,...e},!1!==this.config.isolateConversations){const e=this.config.mode||"widget",t=this.config.containerId||"default",s=`${"undefined"!=typeof performance?performance.now():Date.now()}_${Math.random().toString(36).substr(2,9)}_${Math.random().toString(36).substr(2,5)}`;this.sessionId=`session_${e}_${t}_${s}`}else this.config.sessionId?this.sessionId=this.config.sessionId:this.sessionId=this.generateSessionId();if("undefined"!=typeof window){const e=`__customgpt_widget_${this.sessionId}`;window[e]=this,window.__customgpt_widget_instance||(window.__customgpt_widget_instance=this),this.instanceKey=e}this.init()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async init(){this.config.enableConversationManagement&&(this.config.isolateConversations?(window.__customgpt_sessions||(window.__customgpt_sessions={}),window.__customgpt_sessions[this.sessionId]={sessionId:this.sessionId,maxConversations:this.config.maxConversations,enableConversationManagement:!0}):window.__customgpt_session={sessionId:this.sessionId,maxConversations:this.config.maxConversations,enableConversationManagement:!0});window.__customgpt_demo_mode=!1;const e="string"==typeof this.config.agentId?parseInt(this.config.agentId):this.config.agentId;try{const t=(0,xe.KU)(),s=await t.getAgents(),a=(Array.isArray(s)?s:s.data||[]).find(t=>t.id===e);if(a)this.config.agentName&&(a.project_name=this.config.agentName),i.useAgentStore.getState().selectAgent(a),i.useAgentStore.getState().setAgents([a]);else{const t={id:e,project_name:this.config.agentName||`Project ${e}`,is_chat_active:!0};i.useAgentStore.getState().selectAgent(t),i.useAgentStore.getState().setAgents([t])}}catch(t){const s={id:e,project_name:this.config.agentName||`Project ${e}`,is_chat_active:!0};i.useAgentStore.getState().selectAgent(s),i.useAgentStore.getState().setAgents([s])}if(this.createContainer(),this.render(),this.config.enableConversationManagement){const e=this.getConversations();if(0===e.length)setTimeout(()=>{this.createConversation("New Chat")},100);else if(this.currentConversationId=e[0].id,!1===this.config.isolateConversations&&"undefined"!=typeof window){const{useConversationStore:t}=s(3016),a=e[0],n={...a,project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:a.title};t.setState({conversations:[n],currentConversation:n})}}!1!==this.config.isolateConversations&&"undefined"!=typeof window&&(window.__customgpt_widget_instances=window.__customgpt_widget_instances||{},window.__customgpt_widget_instances[this.sessionId]=this,window.__customgpt_active_widget_session=this.sessionId)}createContainer(){const{mode:e,containerId:t}=this.config;if("embedded"===e&&t){if(this.container=document.getElementById(t),!this.container)throw new Error(`Container with id "${t}" not found`)}else"floating"===e?(this.container=document.createElement("div"),this.container.id="customgpt-floating-widget",this.setupFloatingStyles(),document.body.appendChild(this.container)):(this.container=document.createElement("div"),this.container.id="customgpt-widget",document.body.appendChild(this.container))}setupFloatingStyles(){if(!this.container||"floating"!==this.config.mode)return;const{position:e,width:t,height:s}=this.config;switch(Object.assign(this.container.style,{position:"fixed",zIndex:"9999",width:t||"400px",height:s||"600px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease",backgroundColor:"white"}),this.container.classList.add("floating-mode"),this.container.classList.add("customgpt-floating-container"),e){case"bottom-right":Object.assign(this.container.style,{bottom:"20px",right:"20px"});break;case"bottom-left":Object.assign(this.container.style,{bottom:"20px",left:"20px"});break;case"top-right":Object.assign(this.container.style,{top:"20px",right:"20px"});break;case"top-left":Object.assign(this.container.style,{top:"20px",left:"20px"})}this.container.style.display="none",this.container.style.opacity="0",this.container.style.transform="translateY(20px)"}render(){if(!this.container)return;"embedded"===this.config.mode&&(this.container.classList.add("customgpt-embedded-widget"),Object.assign(this.container.style,{width:this.config.width||"400px",height:this.config.height||"600px",margin:"0 auto",display:"block"})),this.root||(this.root=(0,n.H)(this.container));const e=()=>{"undefined"==typeof window||window.__customgpt_widget_instance||(window.__customgpt_widget_instance=this);const e=this.currentConversationId||this.config.threadId;this.sessionId;return(0,w.jsx)(Ye,{sessionId:this.sessionId,children:(0,w.jsx)(qe,{widgetInstance:this,children:(0,w.jsxs)("div",{className:`customgpt-widget-wrapper widget-mode ${this.config.mode}-mode`,children:[(0,w.jsx)(rs,{mode:"embedded"===this.config.mode?"widget":"floating",onClose:"floating"===this.config.mode?()=>{this.close(),this.config.onClose?.()}:void 0,showSidebar:!1,className:"w-full h-full",enableConversationManagement:this.config.enableConversationManagement,maxConversations:this.config.maxConversations,sessionId:this.sessionId,threadId:e,onConversationChange:this.config.onConversationChange,onMessage:this.config.onMessage,widgetInstance:!1!==this.config.isolateConversations?this:void 0,conversations:!1!==this.config.isolateConversations?this.getConversations():void 0,currentConversation:!1!==this.config.isolateConversations&&this.currentConversationId?this.getConversations().find(e=>e.id===this.currentConversationId):void 0,conversationRefreshKey:this.conversationRefreshKey}),(0,w.jsx)(r.l$,{position:"top-center",closeButton:!0,toastOptions:{style:{zIndex:1e4}}})]})})})};this.root.render((0,w.jsx)(e,{})),"embedded"===this.config.mode&&this.open()}getConversations(){const e=localStorage.getItem(`customgpt_conversations_${this.sessionId}`);if(e)try{return JSON.parse(e)}catch(e){}return[]}switchConversation(e){const t=this.getConversations().find(t=>t.id===e);if(t){if(this.currentConversationId=e,this.conversationRefreshKey++,!this.config.isolateConversations&&"undefined"!=typeof window){const{useConversationStore:t}=s(3016),a=this.getConversations().map(e=>({...e,project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:e.title})),n=a.find(t=>t.id===e);t.setState({conversations:a,currentConversation:n})}this.render(),this.config.onConversationChange?.(t)}}createConversation(e){const t=this.getConversations();if(this.config.maxConversations&&t.length>=this.config.maxConversations)return null;const a={id:`conv_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:e||`Conversation ${t.length+1}`,createdAt:(new Date).toISOString(),messages:[],project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:e||`Conversation ${t.length+1}`};if(t.unshift(a),this.saveConversations(t),this.currentConversationId=a.id,!this.config.isolateConversations&&"undefined"!=typeof window){const{useConversationStore:e,useMessageStore:t}=s(3016),n=t.getState(),r=this.getConversations().map(e=>({...e,project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:e.title}));e.setState({conversations:r,currentConversation:a}),n.clearMessages(a.id)}return this.conversationRefreshKey++,this.render(),a}updateConversationTitle(e,t){const s=this.getConversations(),a=s.find(t=>t.id===e);a&&(a.title=t,this.saveConversations(s),this.conversationRefreshKey++,this.render())}deleteConversation(e){const t=this.getConversations().filter(t=>t.id!==e);this.saveConversations(t),this.conversationRefreshKey++,this.currentConversationId===e?t.length>0?this.switchConversation(t[0].id):this.createConversation():this.render()}saveConversations(e){try{localStorage.setItem(`customgpt_conversations_${this.sessionId}`,JSON.stringify(e))}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&this.cleanupOldConversations()}}cleanupOldConversations(){const e=this.getConversations().slice(0,3);this.saveConversations(e)}open(){this.container&&(this.isOpen=!0,"floating"===this.config.mode&&(this.container.style.display="block",setTimeout(()=>{this.container&&(this.container.style.transform="translateY(0)",this.container.style.opacity="1")},10)),this.config.onOpen?.())}close(){this.container&&(this.isOpen=!1,"floating"===this.config.mode&&(this.container.style.transform="translateY(20px)",this.container.style.opacity="0",setTimeout(()=>{this.container&&(this.container.style.display="none")},300)))}toggle(){this.isOpen?this.close():this.open()}destroy(){this.root&&this.root.unmount(),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.root=null}updateConfig(e){this.config={...this.config,...e},this.render()}refresh(){this.render()}get isOpened(){return this.isOpen}get configuration(){return{...this.config}}}const cs={init:e=>new os(e),create:e=>new os(e)};"undefined"!=typeof window&&(window.CustomGPTWidget=cs);const ls=cs},5772:(e,t,s)=>{"use strict";function a(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,{v:()=>r});class n{constructor(){a(this,"isClient",void 0),a(this,"logs",[]),this.isClient="undefined"!=typeof window}static getInstance(){return n.instance||(n.instance=new n),n.instance}formatMessage(e){const{timestamp:t,level:s,category:a,message:n,data:r,error:i,stack:o}=e;let c=`[${t}] [${s.toUpperCase()}] [${a}] ${n}`;return r&&(c+=`\nData: ${JSON.stringify(r,null,2)}`),i&&(c+=`\nError: ${i.message||i}`,o&&(c+=`\nStack: ${o}`)),c}writeToFile(e){}log(e,t,s,a,n){const r={timestamp:(new Date).toISOString(),level:e,category:t,message:s,data:a,error:n?{message:n.message,code:n.code,status:n.status}:void 0,stack:n?.stack};this.logs.push(r),this.logs.length>1e3&&(this.logs=this.logs.slice(-500));r.timestamp.split("T")[1].split(".")[0];if(this.isClient);else{}}info(e,t,s){this.log("info",e,t,s)}warn(e,t,s){this.log("warn",e,t,s)}error(e,t,s,a){this.log("error",e,t,a,s)}getLogs(){return this.logs}clearLogs(){this.logs=[]}apiRequest(e,t,s){this.info("API_REQUEST",`${t} ${e}`,s)}apiResponse(e,t,s){const a=t>=400?"error":"info";this.log(a,"API_RESPONSE",`${e} - Status: ${t}`,s)}apiError(e,t){this.error("API_ERROR",`Failed request to ${e}`,t)}authCheck(e,t){this.info("AUTH",e,t)}authError(e,t){this.error("AUTH_ERROR",e,t)}navigation(e,t){this.info("NAVIGATION",`Navigating to ${e}`,t)}storeAction(e,t,s){this.info("STORE",`${e}.${t}`,s)}}a(n,"instance",void 0);const r=n.getInstance()},7047:(e,t,s)=>{"use strict";s.d(t,{$C:()=>i,B6:()=>l,Ey:()=>d,I3:()=>c,OX:()=>m,RW:()=>u,aH:()=>h,cn:()=>r,lW:()=>g,v7:()=>o});var a=s(3526),n=s(4799);s(8404);function r(...e){return(0,n.QP)((0,a.$)(e))}function i(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}function o(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function c(e){const t=e.toLowerCase();return t.includes("pdf")||t.includes("word")||t.includes("doc")?"📄":t.includes("text")||t.includes("txt")?"📝":t.includes("image")?"🖼️":t.includes("video")?"🎥":t.includes("audio")?"🎵":t.includes("excel")||t.includes("sheet")?"📊":t.includes("powerpoint")||t.includes("presentation")?"📈":t.includes("json")?"📋":t.includes("csv")?"📊":t.includes("zip")||t.includes("rar")?"🗜️":"📎"}function l(e,t){return t.some(t=>e.toLowerCase().includes(t.toLowerCase()))}function d(e){const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/6e4),n=Math.floor(s/36e5),r=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:n<24?`${n}h ago`:r<7?`${r}d ago`:t.toLocaleDateString()}async function g(e){try{return await navigator.clipboard.writeText(e),!0}catch(e){return!1}}function u(e){try{if(e.startsWith("event: ")){return"finish"===e.slice(7).trim()?{type:"done"}:null}if(e.startsWith("data: ")){const t=e.slice(6).trim();if("[DONE]"===t||"DONE"===t)return{type:"done"};try{const e=JSON.parse(t);if("object"==typeof e){if(e.type)return e;if(void 0!==e.content)return{type:"content",content:e.content,citations:e.citations};if(e.citations&&!e.content)return{type:"citation",citations:e.citations};if(void 0!==e.message)return{type:"content",content:e.message,citations:e.citations};if(e.delta&&void 0!==e.delta.content)return{type:"content",content:e.delta.content,citations:e.citations};if(e.choices&&e.choices[0]&&e.choices[0].delta){const t=e.choices[0].delta;if(void 0!==t.content)return{type:"content",content:t.content,citations:e.citations}}}return e}catch(e){return{type:"content",content:t}}}if(e.trim().startsWith("{"))try{const t=JSON.parse(e.trim());return void 0!==t.content||void 0!==t.citations?{type:t.content?"content":"citation",content:t.content,citations:t.citations}:void 0!==t.message?{type:"content",content:t.message,citations:t.citations}:t}catch(e){}return!e.trim()||e.includes("data:")||e.startsWith("{")?null:{type:"content",content:e.trim()}}catch(e){return null}}function m(e){const t=e.trim().split(/\s+/).slice(0,6).join(" ");return t.length>50?t.substring(0,50).trim()+"...":t}const h={MAX_FILE_SIZE:10485760,ACCEPTED_FILE_TYPES:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","text/csv","application/json","application/xml","image/jpeg","image/png","image/gif","image/webp"],MAX_MESSAGE_LENGTH:4e3,API_TIMEOUT:3e4,STREAM_TIMEOUT:6e4,RETRY_ATTEMPTS:3,RETRY_DELAY:1e3}},7292:(e,t,s)=>{"use strict";s.d(t,{o:()=>c});var a=s(1446),n=s(5189),r=s(4267),i=s(7648),o=s(1582);const c=(0,a.vt)()((0,n.Zr)((e,t)=>({agents:[],currentAgent:null,loading:!1,error:null,paginationMeta:void 0,fetchAgents:async()=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),a=await s.getAgents({page:1,per_page:100});let n=[],i=0,o=!1;if(a&&"object"==typeof a)if("data"in a&&a.data&&"object"==typeof a.data&&"data"in a.data){const e=a.data;n=Array.isArray(e.data)?e.data:[],i=e.total||n.length;const t=e.current_page||1;e.per_page;o=!!e.last_page&&t<e.last_page}else if("data"in a&&"total"in a){const e=a;n=e.data,i=e.total,o=i>e.per_page}else Array.isArray(a.data)?(n=a.data,i=n.length,o=!1):Array.isArray(a)&&(n=a,i=n.length,o=!1);e({agents:n,loading:!1,paginationMeta:{currentPage:1,totalCount:i,hasMore:o,perPage:100},currentAgent:t().currentAgent||(n.length>0?n[0]:null)})}catch(t){e({agents:[],error:t instanceof Error?t.message:"Failed to fetch agents",loading:!1})}},loadMoreAgents:async()=>{const s=t(),a=s.paginationMeta;if(a?.hasMore&&!s.loading){e({loading:!0,error:null});try{const t=(0,r.KU)(),s=a.currentPage+1,n=await t.getAgents({page:s,per_page:a.perPage});if(n&&"data"in n){let t=[],r=0,i=s;if(n.data&&"object"==typeof n.data&&"data"in n.data){const e=n.data;t=Array.isArray(e.data)?e.data:[],r=e.total||0,i=e.current_page||s}else Array.isArray(n.data)&&(t=n.data,r=a.totalCount);e(e=>({agents:[...e.agents,...t],loading:!1,paginationMeta:{...a,currentPage:i,hasMore:i*a.perPage+t.length<r}}))}}catch(t){e({error:t instanceof Error?t.message:"Failed to load more agents",loading:!1})}}},findAgent:async s=>{try{const a=(0,r.KU)();if("number"==typeof s||/^\d+$/.test(s.toString())){const n="number"==typeof s?s:parseInt(s.toString());try{const s=(await a.getAgent(n)).data;return t().agents.find(e=>e.id===s.id)||e(e=>({agents:[s,...e.agents]})),s}catch{}}const n=t();return n.agents.find(e=>e.project_name.toLowerCase().includes(s.toString().toLowerCase())||e.id.toString()===s.toString())||null}catch(e){return null}},createAgent:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),a=(await s.createAgent(t)).data;return e(e=>({agents:[a,...e.agents],currentAgent:a,loading:!1})),a}catch(t){throw e({error:t instanceof Error?t.message:"Failed to create agent",loading:!1}),t}},selectAgent:async t=>{const s=i.w.getState(),a=o.o.getState();e({currentAgent:t}),s.selectConversation(null),a.clearMessages();try{await s.fetchConversations(t.id)}catch(e){}},setAgents:s=>{e({agents:s,currentAgent:(()=>{const e=t().currentAgent;if(!e)return s.length>0?s[0]:null;return s.find(t=>t.id===e.id)||(s.length>0?s[0]:null)})()})},updateAgent:async(t,s)=>{e({loading:!0,error:null});try{const a=(0,r.KU)(),n=(await a.updateAgent(t,s)).data;return e(e=>({agents:e.agents.map(e=>e.id===t?n:e),currentAgent:e.currentAgent?.id===t?n:e.currentAgent,loading:!1})),n}catch(t){throw e({error:t instanceof Error?t.message:"Failed to update agent",loading:!1}),t}},deleteAgent:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)();await s.deleteAgent(t),e(e=>{const s=e.agents.filter(e=>e.id!==t);return{agents:s,currentAgent:e.currentAgent?.id===t?s.length>0?s[0]:null:e.currentAgent,loading:!1}})}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete agent",loading:!1}),t}},replicateAgent:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),a=(await s.replicateAgent(t)).data;return e(e=>({agents:[a,...e.agents],currentAgent:a,loading:!1})),a}catch(t){throw e({error:t instanceof Error?t.message:"Failed to replicate agent",loading:!1}),t}},getAgentStats:async e=>{try{const t=(0,r.KU)();return(await t.getAgentStats(e)).data}catch(e){throw e}}}),{name:"customgpt-agents",partialize:e=>({currentAgent:e.currentAgent})}))},7648:(e,t,s)=>{"use strict";s.d(t,{w:()=>c});var a=s(1446),n=s(5189),r=s(4267),i=s(7047),o=s(5772);const c=(0,a.vt)()((0,n.Zr)((e,t)=>({conversations:[],currentConversation:null,loading:!1,error:null,currentPage:1,totalPages:1,totalConversations:0,perPage:20,sortOrder:"desc",sortBy:"id",userFilter:"all",fetchConversations:async(s,a)=>{o.v.info("CONVERSATIONS","Fetching conversations",{projectId:s,params:a}),e({loading:!0,error:null});try{const n=(0,r.KU)(),i={page:a?.page??t().currentPage,per_page:a?.per_page??t().perPage,order:a?.order??t().sortOrder,orderBy:a?.orderBy??t().sortBy,userFilter:a?.userFilter??t().userFilter},c=await n.getConversations(s,i);o.v.info("CONVERSATIONS","API response received",{projectId:s,responseType:typeof c,hasData:!!c?.data,dataLength:Array.isArray(c?.data)?c.data.length:0});let l=[],d=null;c&&"object"==typeof c&&(c.data&&c.data.data?(l=c.data.data,d=c.data):Array.isArray(c.data)?l=c.data:Array.isArray(c)&&(l=c)),o.v.info("CONVERSATIONS","Processed conversations",{count:l.length,paginationData:d,conversations:l.map(e=>({id:e.id,name:e.name,messagesCount:e.messages?.length||0}))}),e({conversations:l,loading:!1,currentPage:d?.current_page??1,totalPages:d?.last_page??1,totalConversations:d?.total??l.length,...a?.order&&{sortOrder:a.order},...a?.orderBy&&{sortBy:a.orderBy},...a?.userFilter&&{userFilter:a.userFilter}})}catch(t){o.v.error("CONVERSATIONS","Failed to fetch conversations",t,{projectId:s,errorType:t instanceof Error?t.constructor.name:typeof t,status:t?.status,message:t?.message}),e({error:t instanceof Error?t.message:"Failed to fetch conversations",loading:!1})}},createConversation:async(t,s)=>{e({loading:!0,error:null});try{const a=(0,r.KU)(),n=(await a.createConversation(t,s?{name:s}:void 0)).data;e(e=>({conversations:[n,...e.conversations],currentConversation:n,loading:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"Failed to create conversation",loading:!1}),t}},selectConversation:t=>{e({currentConversation:t})},deleteConversation:async s=>{const{conversations:a,currentConversation:n}=t(),i=a.find(e=>e.id.toString()===s.toString());if(i){e({loading:!0,error:null});try{const t=(0,r.KU)();await t.deleteConversation(i.project_id,i.session_id);const o=a.filter(e=>e.id.toString()!==s.toString());e({conversations:o,currentConversation:n?.id.toString()===s.toString()?o.length>0?o[0]:null:n,loading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete conversation",loading:!1}),t}}},updateConversation:async(t,s,a)=>{e({loading:!0,error:null});try{const n=(0,r.KU)(),i=(await n.updateConversation(t,s,a)).data;e(e=>({conversations:e.conversations.map(e=>e.id===t?i:e),currentConversation:e.currentConversation?.id===t?i:e.currentConversation,loading:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"Failed to update conversation",loading:!1}),t}},ensureConversation:async(e,s)=>{const{currentConversation:a}=t();if(a&&a.project_id===e)return a;const n=s?(0,i.OX)(s):`Chat ${(new Date).toLocaleDateString()}`;return await t().createConversation(e,n),t().currentConversation}}),{name:`customgpt-conversations-${(()=>{if("undefined"==typeof window)return"server-session";if(window.__customgpt_current_session)return window.__customgpt_current_session;if(window.__customgpt_session)return window.__customgpt_session.sessionId;if(window.__customgpt_sessions){const e=window.__customgpt_sessions,t=Object.keys(e);if(t.length>0)return t[t.length-1]}try{let e=sessionStorage.getItem("customgpt_session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("customgpt_session_id",e)),e}catch(e){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}})()}`,partialize:e=>({conversations:e.conversations}),onRehydrateStorage:()=>e=>{e&&(Array.isArray(e.conversations)||(e.conversations=[]),e.currentConversation=null)}}))}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,r),s.exports}r.m=a,e=[],r.O=(t,s,a,n)=>{if(!s){var i=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],o=!0,c=0;c<s.length;c++)(!1&n||i>=n)&&Object.keys(r.O).every(e=>r.O[e](s[c]))?s.splice(c--,1):(o=!1,n<i&&(i=n));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);r.r(n);var i={};t=t||[null,s({}),s([]),s(s)];for(var o=2&a&&e;("object"==typeof o||"function"==typeof o)&&!~t.indexOf(o);o=s(o))Object.getOwnPropertyNames(o).forEach(t=>i[t]=()=>e[t]);return i.default=()=>e,r.d(n,i),n},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={30:0};r.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[i,o,c]=s,l=0;if(i.some(t=>0!==e[t])){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(c)var d=c(r)}for(t&&t(s);l<i.length;l++)n=i[l],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(d)},s=Object("undefined"!=typeof self?self:this).webpackChunkCustomGPTWidget=Object("undefined"!=typeof self?self:this).webpackChunkCustomGPTWidget||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var i=r.O(void 0,[96],()=>r(4784));return i=(i=r.O(i)).default})());
//# sourceMappingURL=customgpt-widget.js.map